<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Family Tree React + Firebase + Tailwind</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
</head>
<body class="bg-gradient-to-tr from-indigo-400 via-purple-400 to-pink-400 min-h-screen flex items-center justify-center">
<div id="root" class="w-full max-w-4xl p-4"></div>
<script type="text/javascript">
const { useState, useEffect } = React;
const firebaseConfig = {
  apiKey: "AIzaSyCy9CKJ6CELheBhw7Gs0BgsE1E0FsoYdgU",
  authDomain: "project-955237504610034331.firebaseapp.com",
  databaseURL: "https://project-955237504610034331-default-rtdb.firebaseio.com",
  projectId: "project-955237504610034331",
  storageBucket: "project-955237504610034331.firebasestorage.app",
  messagingSenderId: "76212939677",
  appId: "1:76212939677:web:cc36cc1cadfd106b6e5d74",
  measurementId: "G-RCJ4P82PVM"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.database();

function FamilyMember({ member, onAddChild, onEdit }) {
  const [collapsed, setCollapsed] = useState(false);
  return React.createElement("div", { className: "ml-6 border-l-2 border-indigo-300 pl-4 py-1" },
    React.createElement("div", { className: "flex items-center space-x-2" },
      React.createElement("button", {
        onClick: () => setCollapsed(!collapsed),
        className: "text-indigo-600 font-bold text-xl w-6 h-6 flex items-center justify-center rounded hover:bg-indigo-200"
      }, collapsed ? "▶" : "▼"),
      React.createElement("div", null,
        React.createElement("div", { className: "font-semibold text-lg" }, member.name),
        React.createElement("div", { className: "text-sm text-gray-500" }, `(${member.relation})`),
        member.dateOfBirth && React.createElement("div", { className: "text-sm text-gray-600" }, `DOB: ${member.dateOfBirth}`),
        member.spouse && React.createElement("div", { className: "text-sm text-gray-600" }, `Spouse: ${member.spouse}`),
        member.isDeceased && React.createElement("div", { className: "text-sm text-red-500" }, `Died: ${member.dateOfDeath || 'N/A'}`)
      ),
      React.createElement("button", {
        onClick: () => onAddChild(member.id),
        className: "ml-4 bg-green-500 text-white px-2 rounded hover:bg-green-600 transition"
      }, "Add Child"),
      React.createElement("button", {
        onClick: () => onEdit(member),
        className: "bg-yellow-400 text-white px-2 rounded hover:bg-yellow-500 transition"
      }, "Edit")
    ),
    !collapsed && member.children && member.children.map(child =>
      React.createElement(FamilyMember, {
        key: child.id,
        member: child,
        onAddChild: onAddChild,
        onEdit: onEdit
      })
    )
  );
}

function FamilyTree({ userId }) {
  const [treeData, setTreeData] = useState(null);
  const [editingMember, setEditingMember] = useState(null);
  const [addingParentId, setAddingParentId] = useState(null);
  const [name, setName] = useState("");
  const [relation, setRelation] = useState("");
  const [dateOfBirth, setDateOfBirth] = useState("");
  const [spouse, setSpouse] = useState("");
  const [isDeceased, setIsDeceased] = useState(false);
  const [dateOfDeath, setDateOfDeath] = useState("");

  useEffect(() => {
    const familyRef = db.ref(`families/${userId}`);
    familyRef.on("value", (snapshot) => {
      setTreeData(snapshot.val());
    });
    return () => familyRef.off();
  }, [userId]);

  function buildTree(data) {
    if (!data) return [];
    const map = {};
    Object.values(data).forEach(m => {
      map[m.id] = { ...m, children: [] };
    });
    const roots = [];
    Object.values(map).forEach(m => {
      if (m.parentId && map[m.parentId]) {
        map[m.parentId].children.push(m);
      } else {
        roots.push(m);
      }
    });
    return roots;
  }

  const nestedTree = buildTree(treeData);

  async function saveMember() {
    if (!name.trim() || !relation.trim()) return;
    const data = {
      name,
      relation,
      dateOfBirth,
      spouse,
      isDeceased,
      dateOfDeath: isDeceased ? dateOfDeath : "",
      parentId: addingParentId || null
    };
    if (editingMember) {
      await db.ref(`families/${userId}/${editingMember.id}`).update(data);
      setEditingMember(null);
    } else {
      const newId = Date.now().toString();
      await db.ref(`families/${userId}/${newId}`).set({ id: newId, ...data });
      setAddingParentId(null);
    }
    setName("");
    setRelation("");
    setDateOfBirth("");
    setSpouse("");
    setIsDeceased(false);
    setDateOfDeath("");
  }

  return React.createElement("div", { className: "max-w-4xl mx-auto p-6 bg-white bg-opacity-80 rounded-lg shadow-md mt-8 backdrop-blur-md" },
    React.createElement("h2", { className: "text-3xl font-bold mb-6 text-center text-indigo-700" }, "Family Tree"),
    nestedTree.length === 0 && React.createElement("div", { className: "text-center text-gray-700 mb-6" },
      React.createElement("p", null, "No family members yet."),
      React.createElement("button", {
        onClick: () => setAddingParentId(null),
        className: "mt-2 bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700 transition"
      }, "Add Root Member")
    ),
    nestedTree.map(member =>
      React.createElement(FamilyMember, {
        key: member.id,
        member: member,
        onAddChild: setAddingParentId,
        onEdit: (m) => {
          setEditingMember(m);
          setName(m.name);
          setRelation(m.relation);
          setDateOfBirth(m.dateOfBirth || "");
          setSpouse(m.spouse || "");
          setIsDeceased(!!m.isDeceased);
          setDateOfDeath(m.dateOfDeath || "");
        }
      })
    ),
    (editingMember || addingParentId !== null) && React.createElement("div", { className: "mt-8 p-4 border border-indigo-300 rounded-md max-w-md mx-auto bg-indigo-50" },
      React.createElement("h3", { className: "text-xl font-semibold mb-4 text-indigo-700" }, editingMember ? "Edit Member" : "Add Member"),
      React.createElement("input", {
        type: "text",
        placeholder: "Name",
        value: name,
        onChange: e => setName(e.target.value),
        className: "w-full mb-2 px-3 py-2 border border-indigo-300 rounded"
      }),
      React.createElement("input", {
        type: "text",
        placeholder: "Relation",
        value: relation,
        onChange: e => setRelation(e.target.value),
        className: "w-full mb-2 px-3 py-2 border border-indigo-300 rounded"
      }),
      React.createElement("input", {
        type: "date",
        placeholder: "Date of Birth",
        value: dateOfBirth,
        onChange: e => setDateOfBirth(e.target.value),
        className: "w-full mb-2 px-3 py-2 border border-indigo-300 rounded"
      }),
      React.createElement("input", {
        type: "text",
        placeholder: "Spouse",
        value: spouse,
        onChange: e => setSpouse(e.target.value),
        className: "w-full mb-2 px-3 py-2 border border-indigo-300 rounded"
      }),
      React.createElement("div", { className: "flex items-center mb-2" },
        React.createElement("input", {
          type: "checkbox",
          checked: isDeceased,
          onChange: e => setIsDeceased(e.target.checked),
          className: "mr-2"
        }),
        React.createElement("label", null, "Deceased")
      ),
      isDeceased && React.createElement("input", {
        type: "date",
        placeholder: "Date of Death",
        value: dateOfDeath,
        onChange: e => setDateOfDeath(e.target.value),
        className: "w-full mb-2 px-3 py-2 border border-indigo-300 rounded"
      }),
      React.createElement("div", { className: "flex justify-between" },
        React.createElement("button", {
          onClick: saveMember,
          className: "bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700 transition"
        }, editingMember ? "Save" : "Add"),
        React.createElement("button", {
          onClick: () => {
            setEditingMember(null);
            setAddingParentId(null);
            setName("");
            setRelation("");
            setDateOfBirth("");
            setSpouse("");
            setIsDeceased(false);
            setDateOfDeath("");
          },
          className: "bg-gray-300 text-gray-700 px-4 py-2 rounded hover:bg-gray-400 transition"
        }, "Cancel")
      )
    )
  );
}
</script>
</body>
</html>
