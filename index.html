<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Collapsible Family Tree with Spouse & Editing</title>
  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- React + ReactDOM CDN -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <!-- Babel CDN for JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    .fade-enter {
      max-height: 0;
      opacity: 0;
      overflow: hidden;
      transition: max-height 0.3s ease, opacity 0.3s ease;
    }
    .fade-enter-active {
      max-height: 500px;
      opacity: 1;
    }
    .fade-exit {
      max-height: 500px;
      opacity: 1;
      transition: max-height 0.3s ease, opacity 0.3s ease;
    }
    .fade-exit-active {
      max-height: 0;
      opacity: 0;
      overflow: hidden;
    }
  </style>
</head>
<body class="bg-gray-50 min-h-screen flex items-center justify-center p-4">

  <div id="root" class="w-full max-w-lg bg-white p-6 rounded shadow"></div>

  <script type="text/babel">

    const { useState } = React;

    // Sample family data with spouses
    const initialFamilyData = {
      id: 1,
      name: "Lolo",
      spouse: "Lola",
      children: [
        {
          id: 2,
          name: "Tito",
          spouse: "Tita",
          children: [
            { id: 3, name: "Anak ni Tito 1" },
            { id: 4, name: "Anak ni Tito 2" },
          ],
        },
        {
          id: 5,
          name: "Tita",
          spouse: "Tito",
          children: [
            { id: 6, name: "Anak ni Tita 1" },
          ],
        },
      ],
    };

    function TreeNode({ node, onUpdate }) {
      const [open, setOpen] = useState(false);
      const [editName, setEditName] = useState(false);
      const [editSpouse, setEditSpouse] = useState(false);
      const [tempName, setTempName] = useState(node.name);
      const [tempSpouse, setTempSpouse] = useState(node.spouse || "");

      // Update handler helper
      function updateNode(newNode) {
        onUpdate(newNode);
      }

      function handleNameSave() {
        updateNode({ ...node, name: tempName });
        setEditName(false);
      }

      function handleSpouseSave() {
        updateNode({ ...node, spouse: tempSpouse });
        setEditSpouse(false);
      }

      return (
        <div className="ml-4 mt-2">
          <div className="flex items-center space-x-2 cursor-pointer select-none">
            {node.children && node.children.length > 0 ? (
              <button
                onClick={() => setOpen(!open)}
                className="text-blue-600 font-bold w-5 h-5 flex items-center justify-center"
                aria-label={open ? "Collapse" : "Expand"}
              >
                {open ? "▼" : "▶"}
              </button>
            ) : (
              <span className="w-5" />
            )}

            <div className="flex space-x-2 items-center">
              {/* Name */}
              {editName ? (
                <input
                  type="text"
                  className="border border-gray-300 rounded px-1 py-0.5 text-sm"
                  value={tempName}
                  onChange={e => setTempName(e.target.value)}
                  onBlur={handleNameSave}
                  onKeyDown={e => {
                    if (e.key === "Enter") handleNameSave();
                  }}
                  autoFocus
                />
              ) : (
                <span
                  className="font-semibold text-gray-800 hover:text-blue-700"
                  onClick={() => setEditName(true)}
                  title="Click to edit name"
                >
                  {node.name}
                </span>
              )}

              {/* Spouse */}
              {node.spouse !== undefined && (
                <>
                  <span className="text-gray-400"> &amp; </span>
                  {editSpouse ? (
                    <input
                      type="text"
                      className="border border-gray-300 rounded px-1 py-0.5 text-sm"
                      value={tempSpouse}
                      onChange={e => setTempSpouse(e.target.value)}
                      onBlur={handleSpouseSave}
                      onKeyDown={e => {
                        if (e.key === "Enter") handleSpouseSave();
                      }}
                      autoFocus
                    />
                  ) : (
                    <span
                      className="italic text-gray-600 hover:text-blue-700 cursor-pointer"
                      onClick={() => setEditSpouse(true)}
                      title="Click to edit spouse"
                    >
                      {node.spouse || "(add spouse)"}
                    </span>
                  )}
                </>
              )}
            </div>
          </div>

          {/* Children with animation */}
          <div
            style={{
              maxHeight: open ? "1000px" : "0",
              opacity: open ? 1 : 0,
              overflow: "hidden",
              transition: "max-height 0.3s ease, opacity 0.3s ease",
              marginLeft: "1rem",
              borderLeft: open ? "2px solid #CBD5E1" : "none",
              paddingLeft: open ? "1rem" : "0",
            }}
          >
            {open && node.children && node.children.length > 0 && (
              <div>
                {node.children.map(child => (
                  <TreeNode
                    key={child.id}
                    node={child}
                    onUpdate={updatedChild => {
                      // Replace the child in children array and call onUpdate
                      const updatedChildren = node.children.map(c =>
                        c.id === updatedChild.id ? updatedChild : c
                      );
                      updateNode({ ...node, children: updatedChildren });
                    }}
                  />
                ))}
              </div>
            )}
          </div>
        </div>
      );
    }

    function FamilyTree() {
      const [data, setData] = useState(initialFamilyData);

      return (
        <div>
          <h1 className="text-2xl font-bold mb-4 text-center">Collapsible Family Tree</h1>
          <TreeNode
            node={data}
            onUpdate={updatedNode => setData(updatedNode)}
          />
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<FamilyTree />);

  </script>
</body>
</html>
