<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Family Tree</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
</head>
<body class="bg-gradient-to-tr from-indigo-400 via-purple-400 to-pink-400 min-h-screen flex flex-col justify-between">

<div id="root" class="flex-grow w-full max-w-5xl mx-auto p-4"></div>

<footer class="text-center py-4 bg-white bg-opacity-20 backdrop-blur-md text-white mt-8 rounded-t-xl">
  &copy; 2025 Maki Web. All rights reserved
</footer>

<script type="text/javascript">
  const { useState, useEffect } = React;

  const firebaseConfig = {
    apiKey: "AIzaSyCy9CKJ6CELheBhw7Gs0BgsE1E0FsoYdgU",
    authDomain: "project-955237504610034331.firebaseapp.com",
    databaseURL: "https://project-955237504610034331-default-rtdb.firebaseio.com",
    projectId: "project-955237504610034331",
    storageBucket: "project-955237504610034331.firebasestorage.app",
    messagingSenderId: "76212939677",
    appId: "1:76212939677:web:cc36cc1cadfd106b6e5d74",
    measurementId: "G-RCJ4P82PVM"
  };

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.database();

  function Login({ onLogin }) {
    const [email, setEmail] = useState("");
    const [password, setPassword] = useState("");
    const [isRegister, setIsRegister] = useState(false);
    const [error, setError] = useState(null);

    const handleSubmit = async (e) => {
      e.preventDefault();
      setError(null);
      try {
        if (isRegister) {
          await auth.createUserWithEmailAndPassword(email, password);
        } else {
          await auth.signInWithEmailAndPassword(email, password);
        }
        onLogin();
      } catch (err) {
        setError(err.message);
      }
    };

    return (
      React.createElement("div", { className: "max-w-md mx-auto mt-24 p-8 bg-white bg-opacity-70 rounded-lg shadow-lg backdrop-blur-md" },
        React.createElement("h2", { className: "text-3xl font-bold mb-6 text-center" }, isRegister ? "Register" : "Login"),
        React.createElement("form", { onSubmit: handleSubmit, className: "space-y-4" },
          React.createElement("input", { type: "email", required: true, placeholder: "Email", value: email, onChange: e => setEmail(e.target.value), className: "w-full px-4 py-2 border rounded" }),
          React.createElement("input", { type: "password", required: true, placeholder: "Password", value: password, onChange: e => setPassword(e.target.value), className: "w-full px-4 py-2 border rounded" }),
          React.createElement("button", { type: "submit", className: "w-full bg-indigo-600 text-white py-2 rounded" }, isRegister ? "Register" : "Login")
        ),
        error && React.createElement("p", { className: "text-red-600 text-center" }, error),
        React.createElement("p", {
          className: "text-indigo-600 text-center mt-4 cursor-pointer hover:underline",
          onClick: () => setIsRegister(!isRegister)
        }, isRegister ? "Already have an account? Login" : "No account? Register")
      )
    );
  }

  function FamilyMember({ member, onAddChild, onEdit }) {
    const [collapsed, setCollapsed] = useState(false);
    return React.createElement("div", { className: "ml-6 border-l-2 border-indigo-300 pl-4 py-1" },
      React.createElement("div", { className: "flex items-center space-x-2" },
        React.createElement("button", {
          onClick: () => setCollapsed(!collapsed),
          className: "text-xl w-6 h-6 flex items-center justify-center font-bold text-indigo-700"
        }, collapsed ? "▶" : "▼"),
        React.createElement("span", { className: "font-semibold text-lg" }, member.name),
        React.createElement("span", { className: "text-sm text-gray-600" }, `(${member.relation})`),
        React.createElement("button", { onClick: () => onAddChild(member.id), className: "bg-green-500 text-white px-2 rounded" }, "Add Child"),
        React.createElement("button", { onClick: () => onEdit(member), className: "bg-yellow-500 text-white px-2 rounded" }, "Edit")
      ),
      !collapsed && member.children && member.children.map(child =>
        React.createElement(FamilyMember, {
          key: child.id,
          member: child,
          onAddChild,
          onEdit
        })
      )
    );
  }

  function FamilyTree({ userId }) {
    const [treeData, setTreeData] = useState(null);
    const [editingMember, setEditingMember] = useState(null);
    const [addingParentId, setAddingParentId] = useState(null);
    const [form, setForm] = useState({ name: "", relation: "", birthdate: "", spouse: "", isDeceased: false, deathdate: "" });

    useEffect(() => {
      const ref = db.ref(`families/${userId}`);
      ref.on("value", snapshot => {
        setTreeData(snapshot.val());
      });
      return () => ref.off();
    }, [userId]);

    const buildTree = (data) => {
      if (!data) return [];
      const map = {};
      Object.values(data).forEach(m => map[m.id] = { ...m, children: [] });
      const roots = [];
      Object.values(map).forEach(m => {
        if (m.parentId && map[m.parentId]) {
          map[m.parentId].children.push(m);
        } else {
          roots.push(m);
        }
      });
      return roots;
    };

    const saveMember = async () => {
      if (!form.name.trim()) return;
      if (editingMember) {
        await db.ref(`families/${userId}/${editingMember.id}`).update({ ...form });
        setEditingMember(null);
      } else {
        const id = Date.now().toString();
        await db.ref(`families/${userId}/${id}`).set({ id, ...form, parentId: addingParentId || null });
        setAddingParentId(null);
      }
      setForm({ name: "", relation: "", birthdate: "", spouse: "", isDeceased: false, deathdate: "" });
    };

    const nestedTree = buildTree(treeData);

    return React.createElement("div", { className: "p-6 bg-white bg-opacity-80 rounded-lg shadow-md backdrop-blur-md" },
      React.createElement("h2", { className: "text-3xl font-bold text-center mb-4" }, "Family Tree"),

      nestedTree.length === 0 && React.createElement("div", { className: "text-center mb-4" },
        React.createElement("p", null, "No family members yet."),
        React.createElement("button", {
          onClick: () => setAddingParentId(null),
          className: "mt-2 bg-indigo-600 text-white px-4 py-2 rounded"
        }, "Add Root Member")
      ),

      nestedTree.map(member =>
        React.createElement(FamilyMember, {
          key: member.id,
          member,
          onAddChild: setAddingParentId,
          onEdit: (m) => {
            setEditingMember(m);
            setForm({ name: m.name, relation: m.relation || "", birthdate: m.birthdate || "", spouse: m.spouse || "", isDeceased: !!m.isDeceased, deathdate: m.deathdate || "" });
          }
        })
      ),

      (editingMember || addingParentId !== null) && React.createElement("div", { className: "mt-6 p-4 border rounded bg-indigo-50 max-w-md mx-auto" },
        React.createElement("h3", { className: "text-xl font-semibold mb-2" }, editingMember ? "Edit Member" : "Add Member"),
        ["name", "relation", "birthdate", "spouse", "deathdate"].map(field =>
          React.createElement("input", {
            key: field,
            type: field.includes("date") ? "date" : "text",
            placeholder: field.charAt(0).toUpperCase() + field.slice(1),
            value: form[field],
            onChange: e => setForm({ ...form, [field]: e.target.value }),
            className: "w-full mb-2 px-3 py-2 border rounded"
          })
        ),
        React.createElement("label", { className: "flex items-center space-x-2 mb-4" },
          React.createElement("input", {
            type: "checkbox",
            checked: form.isDeceased,
            onChange: e => setForm({ ...form, isDeceased: e.target.checked })
          }),
          React.createElement("span", null, "Deceased")
        ),
        React.createElement("div", { className: "flex justify-between" },
          React.createElement("button", {
            onClick: saveMember,
            className: "bg-indigo-600 text-white px-4 py-2 rounded"
          }, editingMember ? "Save" : "Add"),
          React.createElement("button", {
            onClick: () => {
              setEditingMember(null);
              setAddingParentId(null);
              setForm({ name: "", relation: "", birthdate: "", spouse: "", isDeceased: false, deathdate: "" });
            },
            className: "bg-gray-300 text-gray-800 px-4 py-2 rounded"
          }, "Cancel")
        )
      )
    );
  }

  function App() {
    const [user, setUser] = useState(null);
    useEffect(() => {
      const unsubscribe = auth.onAuthStateChanged(setUser);
      return () => unsubscribe();
    }, []);
    return user
      ? React.createElement("div", null,
          React.createElement("header", { className: "flex justify-between items-center mb-4" },
            React.createElement("h1", { className: "text-white text-4xl font-bold" }, "My Family Tree"),
            React.createElement("button", {
              onClick: () => auth.signOut(),
              className: "bg-white bg-opacity-70 text-indigo-700 px-4 py-2 rounded"
            }, "Logout")
          ),
          React.createElement(FamilyTree, { userId: user.uid })
        )
      : React.createElement(Login, { onLogin: () => {} });
  }

  ReactDOM.createRoot(document.getElementById("root")).render(React.createElement(App));
</script>
</body>
</html>
