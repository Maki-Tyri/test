<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Family Tree App - Minimal</title>
  <style>
    body { font-family: Arial; max-width: 600px; margin: auto; padding: 20px; }
    .member { border: 1px solid #ccc; margin-bottom: 10px; padding: 10px; border-radius: 5px; }
    button { margin-top: 10px; padding: 6px 12px; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/babel-standalone@6.26.0/babel.min.js"></script>

  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

  <script type="text/babel">

    const { useState, useEffect } = React;

    const firebaseConfig = {
      apiKey: "AIzaSyCy9CKJ6CELheBhw7Gs0BgsE1E0FsoYdgU",
      authDomain: "project-955237504610034331.firebaseapp.com",
      databaseURL: "https://project-955237504610034331-default-rtdb.firebaseio.com",
      projectId: "project-955237504610034331",
      storageBucket: "project-955237504610034331.firebasestorage.app",
      messagingSenderId: "76212939677",
      appId: "1:76212939677:web:cc36cc1cadfd106b6e5d74",
      measurementId: "G-RCJ4P82PVM"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const database = firebase.database();

    function Login({ onLogin }) {
      const [email, setEmail] = useState('');
      const [password, setPassword] = useState('');
      const [error, setError] = useState('');

      const handleSubmit = e => {
        e.preventDefault();
        setError('');
        auth.signInWithEmailAndPassword(email, password)
          .then(u => onLogin(u.user))
          .catch(err => setError(err.message));
      };

      return (
        <form onSubmit={handleSubmit}>
          <h2>Login</h2>
          <input type="email" value={email} onChange={e=>setEmail(e.target.value)} placeholder="Email" required />
          <br />
          <input type="password" value={password} onChange={e=>setPassword(e.target.value)} placeholder="Password" required />
          <br />
          <button type="submit">Login</button>
          {error && <p style={{color: 'red'}}>{error}</p>}
        </form>
      );
    }

    function Member({ id, data, onSave }) {
      const [name, setName] = useState(data.name || '');
      const [birthDate, setBirthDate] = useState(data.birthDate || '');
      const [isDeceased, setIsDeceased] = useState(data.isDeceased || false);
      const [dateDied, setDateDied] = useState(data.dateDied || '');
      const [expanded, setExpanded] = useState(false);

      useEffect(() => {
        setName(data.name || '');
        setBirthDate(data.birthDate || '');
        setIsDeceased(data.isDeceased || false);
        setDateDied(data.dateDied || '');
      }, [data]);

      const save = () => {
        onSave(id, { name, birthDate, isDeceased, dateDied: isDeceased ? dateDied : null });
        setExpanded(false);
      };

      return (
        <div className="member">
          <div style={{ cursor: 'pointer' }} onClick={() => setExpanded(!expanded)}>
            <b>{name || 'Unnamed'}</b> {expanded ? '▲' : '▼'}
          </div>
          {expanded && (
            <>
              <input type="text" value={name} onChange={e => setName(e.target.value)} placeholder="Name" />
              <br />
              <input type="date" value={birthDate} onChange={e => setBirthDate(e.target.value)} />
              <br />
              <label>
                <input type="checkbox" checked={isDeceased} onChange={e => setIsDeceased(e.target.checked)} /> Deceased
              </label>
              <br />
              {isDeceased && <input type="date" value={dateDied} onChange={e => setDateDied(e.target.value)} />}
              <br />
              <button onClick={save}>Save</button>
            </>
          )}
        </div>
      );
    }

    function App() {
      const [user, setUser] = useState(null);
      const [members, setMembers] = useState({});
      const [loading, setLoading] = useState(true);
      const [error, setError] = useState('');

      useEffect(() => {
        const unsubscribe = auth.onAuthStateChanged(u => {
          setUser(u);
          setLoading(false);
        });
        return () => unsubscribe();
      }, []);

      useEffect(() => {
        if (!user) return;
        const ref = database.ref('members');
        ref.on('value', snapshot => {
          setMembers(snapshot.val() || {});
        }, err => {
          setError(err.message);
        });
        return () => ref.off();
      }, [user]);

      const logout = () => auth.signOut();

      const saveMember = (id, data) => {
        database.ref('members/' + id).set(data)
          .catch(err => setError(err.message));
      };

      const addRoot = () => {
        const name = prompt("Root member name:");
        if (!name) return alert("Name required");
        const newRef = database.ref('members').push();
        newRef.set({
          name,
          birthDate: '',
          isDeceased: false,
          dateDied: null,
        }).catch(err => setError(err.message));
      };

      if (loading) return <p>Loading...</p>;
      if (!user) return <Login onLogin={setUser} />;

      return (
        <div>
          <h1>Family Tree</h1>
          <button onClick={logout}>Logout</button>
          <button onClick={addRoot} style={{ marginLeft: 10 }}>Add Root Member</button>
          {error && <p style={{color: 'red'}}>{error}</p>}
          {Object.entries(members).length === 0 && <p>No members yet</p>}
          {Object.entries(members).map(([id, data]) => (
            <Member key={id} id={id} data={data} onSave={saveMember} />
          ))}
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);

  </script>
</body>
</html>
