<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Family Tree App with Firebase</title>
<style>
  /* Reset */
  * {
    box-sizing: border-box;
  }
  body, html {
    margin: 0; padding: 0; height: 100%;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #f0f4f8;
    display: flex;
    flex-direction: column;
    min-height: 100vh;
  }

  /* ----------- LOGIN PAGE ----------- */
  #login-page {
    flex: 1;
    display: flex;
    justify-content: center;
    align-items: center;
    background: url('https://images.unsplash.com/photo-1503264116251-35a269479413?auto=format&fit=crop&w=800&q=80') no-repeat center/cover;
    padding: 20px;
  }
  #login-container {
    background: rgba(255 255 255 / 0.15);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    border-radius: 14px;
    padding: 40px 30px;
    width: 320px;
    box-shadow: 0 8px 32px rgba(0,0,0,0.12);
    color: #fff;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  #login-container h2 {
    margin-bottom: 24px;
    font-weight: 700;
    font-size: 1.8rem;
    letter-spacing: 1.2px;
  }
  #login-container input[type="text"],
  #login-container input[type="password"] {
    width: 100%;
    padding: 12px 15px;
    margin: 10px 0 20px;
    border-radius: 8px;
    border: none;
    font-size: 1rem;
    outline: none;
  }
  #login-container button {
    width: 100%;
    padding: 14px 0;
    background: #007bff;
    border: none;
    border-radius: 8px;
    font-weight: 700;
    color: white;
    font-size: 1.1rem;
    cursor: pointer;
    transition: background 0.3s ease;
  }
  #login-container button:hover {
    background: #0056b3;
  }

  /* ----------- MAIN APP ----------- */
  #app {
    flex: 1;
    display: flex;
    min-height: 0; /* for flex children to shrink properly */
    overflow: hidden;
    background: #e9f0ff;
  }

  /* Side connections panel */
  #connections-panel {
    background: #ffffffdd;
    width: 200px;
    border-right: 2px solid #007bff;
    overflow-y: auto;
    padding: 10px 8px;
    font-size: 0.9rem;
    user-select: none;
    box-shadow: inset -3px 0 8px -3px rgba(0,123,255,0.3);
  }
  #connections-panel h3 {
    font-weight: 600;
    margin: 10px 0;
    color: #007bff;
    border-bottom: 1px solid #007bff;
    padding-bottom: 6px;
  }
  #connections-list {
    list-style: none;
    margin: 0;
    padding: 0;
  }
  #connections-list li {
    margin: 8px 0;
    cursor: pointer;
    color: #004a99;
    transition: color 0.2s;
  }
  #connections-list li:hover {
    color: #007bff;
    text-decoration: underline;
  }

  /* Family tree container - flexible & scrollable */
  #family-tree-container {
    flex: 1;
    overflow: auto;
    padding: 20px;
    display: flex;
    justify-content: flex-start;
    align-items: flex-start;
    /* allow wrapping for responsiveness */
    flex-wrap: wrap;
    gap: 20px;
    min-width: 0; /* important for flex shrink */
  }

  /* The tree container grows with members */
  #tree-root {
    display: flex;
    flex-direction: column;
    gap: 40px;
    max-width: 100%;
    min-width: 280px;
  }

  /* Each person node */
  .tree-node {
    background: white;
    border-radius: 12px;
    box-shadow: 0 3px 8px rgb(0 0 0 / 0.12);
    padding: 12px 16px;
    min-width: 260px;
    max-width: 320px;
    user-select: none;
    flex-shrink: 0;
  }
  .tree-node.spouse-node {
    background: #e8f0fe;
    border: 1.5px solid #007bff;
  }

  .node-header {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: 8px;
    margin-bottom: 10px;
  }
  .node-header input[type="text"] {
    flex-grow: 1;
    font-weight: 600;
    font-size: 1.1rem;
    border: none;
    border-bottom: 1.5px solid #007bff;
    padding: 4px 6px;
    outline-offset: 2px;
    background: transparent;
  }
  .node-header input[type="text"]:focus {
    background: #dbe9ff;
  }
  .node-header input[type="date"] {
    border-radius: 6px;
    border: 1px solid #aaa;
    padding: 4px 8px;
    font-size: 0.9rem;
  }
  .node-header input[type="checkbox"] {
    width: 18px;
    height: 18px;
    cursor: pointer;
  }

  /* Buttons container */
  .node-buttons {
    display: flex;
    gap: 6px;
    flex-wrap: nowrap;
  }
  .node-buttons button {
    cursor: pointer;
    border-radius: 6px;
    border: none;
    background: #007bff;
    color: white;
    font-weight: 600;
    padding: 6px 10px;
    font-size: 0.85rem;
    transition: background 0.25s ease;
  }
  .node-buttons button:hover {
    background: #0056b3;
  }
  .node-buttons .delete-btn {
    background: #dc3545;
  }
  .node-buttons .delete-btn:hover {
    background: #a71d2a;
  }

  /* Spouses container - horizontal with gap */
  .spouses-container {
    display: flex;
    gap: 12px;
    margin-bottom: 8px;
    position: relative;
  }
  /* horizontal connecting line between spouses */
  .spouses-container::before {
    content: "";
    position: absolute;
    top: 20px;
    left: 0;
    right: 0;
    height: 2px;
    background-color: #007bff;
    z-index: 0;
    margin: auto;
    width: 80%;
    border-radius: 2px;
  }

  /* Children container vertical stack */
  .children-container {
    margin-left: 30px;
    border-left: 2px solid #007bff;
    padding-left: 20px;
    display: flex;
    flex-direction: column;
    gap: 30px;
  }

  /* Footer fixed with glass background */
  footer {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    padding: 14px 0;
    text-align: center;
    font-weight: 600;
    background: rgba(255 255 255 / 0.15);
    backdrop-filter: blur(15px);
    -webkit-backdrop-filter: blur(15px);
    color: #007bff;
    box-shadow: 0 -2px 8px rgba(0, 123, 255, 0.15);
    user-select: none;
    z-index: 999;
  }

  /* Responsive tweaks */
  @media (max-width: 900px) {
    #connections-panel {
      width: 140px;
      font-size: 0.85rem;
      padding: 6px 4px;
    }
    #login-container {
      width: 90vw;
      padding: 30px 20px;
    }
    .tree-node {
      min-width: 220px;
      max-width: 280px;
    }
  }
  @media (max-width: 600px) {
    #app {
      flex-direction: column;
    }
    #connections-panel {
      width: 100%;
      height: 120px;
      border-right: none;
      border-bottom: 2px solid #007bff;
      display: flex;
      overflow-x: auto;
      overflow-y: hidden;
      white-space: nowrap;
      padding: 6px 12px;
    }
    #connections-list li {
      display: inline-block;
      margin: 0 10px;
      cursor: pointer;
      font-size: 1rem;
    }
    #family-tree-container {
      flex: 1;
      padding: 12px 8px;
      overflow-x: auto;
      overflow-y: visible;
      /* Allow tree to not shrink too small */
      min-width: 280px;
    }
    #tree-root {
      flex-wrap: wrap;
      gap: 16px;
    }
    .children-container {
      margin-left: 15px;
      padding-left: 10px;
      border-left-width: 1.5px;
    }
  }
</style>
</head>
<body>

<!-- LOGIN PAGE -->
<div id="login-page">
  <div id="login-container">
    <h2>Family Tree Login</h2>
    <input id="username" type="text" placeholder="Username" autocomplete="off" />
    <input id="password" type="password" placeholder="Password" autocomplete="off" />
    <button id="login-btn">Login</button>
  </div>
</div>

<!-- MAIN APP -->
<div id="app" style="display:none;">
  <aside id="connections-panel">
    <h3>Connections</h3>
    <ul id="connections-list"></ul>
  </aside>
  <main id="family-tree-container">
    <div id="tree-root"></div>
  </main>
</div>

<footer>
  Family Tree App Â© 2025
</footer>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
  // Firebase config (replace with your config)
  const firebaseConfig = {
    apiKey: "AIzaSyCZyl0plSe2U48P3czGdfJ2c1FSpOJkOiY",
    authDomain: "psa-sample-project-29887.firebaseapp.com",
    databaseURL: "https://psa-sample-project-29887-default-rtdb.firebaseio.com",
    projectId: "psa-sample-project-29887",
    storageBucket: "psa-sample-project-29887.appspot.com",
    messagingSenderId: "823703225224",
    appId: "1:823703225224:web:d840f0f9b576f7160b193a",
    measurementId: "G-5LR8KN6Z3T"
  };

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  // DOM references
  const loginPage = document.getElementById('login-page');
  const app = document.getElementById('app');
  const loginBtn = document.getElementById('login-btn');
  const usernameInput = document.getElementById('username');
  const passwordInput = document.getElementById('password');
  const connectionsList = document.getElementById('connections-list');
  const treeRoot = document.getElementById('tree-root');

  // Simple login (just demo)
  loginBtn.addEventListener('click', () => {
    if(usernameInput.value.trim() && passwordInput.value.trim()) {
      loginPage.style.display = 'none';
      app.style.display = 'flex';
      loadFamilyTree();
      loadConnections();
    } else {
      alert('Please enter username and password');
    }
  });

  // Load family tree from Firebase
  function loadFamilyTree() {
    db.ref('familyTree').on('value', (snapshot) => {
      const data = snapshot.val();
      if (!data) {
        treeRoot.innerHTML = '<p>No family data found.</p>';
        return;
      }
      treeRoot.innerHTML = '';
      // Assuming root person is top-level key (customize as needed)
      Object.keys(data).forEach(personId => {
        const person = data[personId];
        const personNode = createPersonNode(person, personId);
        treeRoot.appendChild(personNode);
      });
    });
  }

  // Load connections (e.g. a list of family member names)
  function loadConnections() {
    db.ref('familyTree').on('value', (snapshot) => {
      const data = snapshot.val();
      connectionsList.innerHTML = '';
      if (!data) return;
      Object.entries(data).forEach(([id, person]) => {
        const li = document.createElement('li');
        li.textContent = person.name || 'Unnamed';
        li.onclick = () => alert(`Clicked on ${person.name}`);
        connectionsList.appendChild(li);
      });
    });
  }

  // Create a person node DOM element recursively
  function createPersonNode(person, id) {
    const container = document.createElement('div');
    container.className = 'tree-node';
    container.dataset.id = id;

    const header = document.createElement('div');
    header.className = 'node-header';

    const nameInput = document.createElement('input');
    nameInput.type = 'text';
    nameInput.value = person.name || '';
    nameInput.placeholder = 'Name';
    nameInput.onchange = () => updatePerson(id, 'name', nameInput.value);
    header.appendChild(nameInput);

    const birthInput = document.createElement('input');
    birthInput.type = 'date';
    birthInput.value = person.birthdate || '';
    birthInput.title = 'Birthdate';
    birthInput.onchange = () => updatePerson(id, 'birthdate', birthInput.value);
    header.appendChild(birthInput);

    const aliveCheckbox = document.createElement('input');
    aliveCheckbox.type = 'checkbox';
    aliveCheckbox.checked = person.alive !== false; // default alive true
    aliveCheckbox.title = 'Alive?';
    aliveCheckbox.onchange = () => updatePerson(id, 'alive', aliveCheckbox.checked);
    header.appendChild(aliveCheckbox);

    container.appendChild(header);

    // Spouses container (if any)
    if (person.spouses) {
      const spousesDiv = document.createElement('div');
      spousesDiv.className = 'spouses-container';
      Object.entries(person.spouses).forEach(([spouseId, spouse]) => {
        const spouseNode = document.createElement('div');
        spouseNode.className = 'tree-node spouse-node';
        spouseNode.dataset.id = spouseId;

        const spouseNameInput = document.createElement('input');
        spouseNameInput.type = 'text';
        spouseNameInput.value = spouse.name || '';
        spouseNameInput.placeholder = 'Spouse Name';
        spouseNameInput.onchange = () => updateSpouse(id, spouseId, 'name', spouseNameInput.value);
        spouseNode.appendChild(spouseNameInput);

        spousesDiv.appendChild(spouseNode);
      });
      container.appendChild(spousesDiv);
    }

    // Children container (recursive)
    if (person.children) {
      const childrenDiv = document.createElement('div');
      childrenDiv.className = 'children-container';
      Object.entries(person.children).forEach(([childId, child]) => {
        const childNode = createPersonNode(child, childId);
        childrenDiv.appendChild(childNode);
      });
      container.appendChild(childrenDiv);
    }

    // Buttons (for add child, add spouse, delete)
    const btns = document.createElement('div');
    btns.className = 'node-buttons';

    const addChildBtn = document.createElement('button');
    addChildBtn.textContent = '+ Child';
    addChildBtn.onclick = () => addChild(id);
    btns.appendChild(addChildBtn);

    const addSpouseBtn = document.createElement('button');
    addSpouseBtn.textContent = '+ Spouse';
    addSpouseBtn.onclick = () => addSpouse(id);
    btns.appendChild(addSpouseBtn);

    const deleteBtn = document.createElement('button');
    deleteBtn.textContent = 'Delete';
    deleteBtn.className = 'delete-btn';
    deleteBtn.onclick = () => deletePerson(id);
    btns.appendChild(deleteBtn);

    container.appendChild(btns);

    return container;
  }

  // Update person data in Firebase
  function updatePerson(id, field, value) {
    db.ref('familyTree/' + id).update({ [field]: value });
  }
  // Update spouse data
  function updateSpouse(personId, spouseId, field, value) {
    db.ref(`familyTree/${personId}/spouses/${spouseId}`).update({ [field]: value });
  }

  // Add child - creates a new child under person with empty data
  function addChild(parentId) {
    const newChildRef = db.ref('familyTree').push();
    const newChildId = newChildRef.key;
    newChildRef.set({
      name: 'New Child',
      birthdate: '',
      alive: true,
      spouses: {},
      children: {}
    });
    // Add child reference under parent
    db.ref(`familyTree/${parentId}/children/${newChildId}`).set({
      name: 'New Child',
      birthdate: '',
      alive: true,
      spouses: {},
      children: {}
    });
  }

  // Add spouse - adds a spouse under person
  function addSpouse(personId) {
    const newSpouseRef = db.ref('familyTree').push();
    const newSpouseId = newSpouseRef.key;
    newSpouseRef.set({
      name: 'New Spouse',
      birthdate: '',
      alive: true,
      spouses: {},
      children: {}
    });
    db.ref(`familyTree/${personId}/spouses/${newSpouseId}`).set({
      name: 'New Spouse',
      birthdate: '',
      alive: true,
      spouses: {},
      children: {}
    });
  }

  // Delete person completely
  function deletePerson(id) {
    if (!confirm('Are you sure you want to delete this person and their references?')) return;

    // Remove person data
    db.ref('familyTree/' + id).remove();

    // Remove this person from all spouses and children references
    db.ref('familyTree').once('value').then(snapshot => {
      const data = snapshot.val();
      if (!data) return;

      Object.entries(data).forEach(([pid, person]) => {
        if (person.spouses && person.spouses[id]) {
          db.ref(`familyTree/${pid}/spouses/${id}`).remove();
        }
        if (person.children && person.children[id]) {
          db.ref(`familyTree/${pid}/children/${id}`).remove();
        }
      });
    });
  }
</script>

</body>
</html>
