<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Family Tree with Multiple Spouses</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; }
    #login, #tree-container { display: none; padding: 20px; }
    .tree-node { border: 1px solid #ccc; padding: 10px; margin: 10px; border-radius: 6px; background: #f9f9f9; }
    .spouses { margin-top: 10px; padding-left: 15px; border-left: 3px solid #aaa; }
    .spouse { margin-bottom: 10px; }
    .tree-children { margin-left: 20px; border-left: 2px dashed #ccc; padding-left: 10px; }
  </style>
</head>
<body>
  <h1 style="padding: 20px;">Family Tree App (Multiple Spouses)</h1>

  <div id="login">
    <h2>Login</h2>
    <input type="email" id="email" placeholder="Email"><br><br>
    <input type="password" id="password" placeholder="Password"><br><br>
    <button onclick="login()">Login</button>
    <button onclick="signup()">Sign Up</button>
  </div>

  <div id="tree-container">
    <button onclick="logout()">Logout</button>
    <h2>Your Family Tree</h2>
    <div id="tree"></div>
  </div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

  <script>
    // ðŸ”§ Replace with your Firebase project config
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_AUTH_DOMAIN",
      projectId: "YOUR_PROJECT_ID",
      databaseURL: "YOUR_DATABASE_URL",
      storageBucket: "YOUR_STORAGE_BUCKET",
      messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    // ðŸ”‘ Auth
    auth.onAuthStateChanged(user => {
      if (user) {
        document.getElementById("login").style.display = "none";
        document.getElementById("tree-container").style.display = "block";
        loadTree();
      } else {
        document.getElementById("login").style.display = "block";
        document.getElementById("tree-container").style.display = "none";
      }
    });

    function login() {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      auth.signInWithEmailAndPassword(email, password).catch(alert);
    }

    function signup() {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      auth.createUserWithEmailAndPassword(email, password).catch(alert);
    }

    function logout() {
      auth.signOut();
    }

    // ðŸŒ³ Load Tree
    function loadTree() {
      const uid = auth.currentUser.uid;
      const treeDiv = document.getElementById("tree");
      treeDiv.innerHTML = "Loading tree...";

      db.ref("users/" + uid + "/family").once("value", snapshot => {
        const data = snapshot.val();
        if (!data) {
          treeDiv.innerHTML = "No family data found.";
          return;
        }

        // Build a lookup of nodes
        const nodes = {};
        for (const id in data) {
          nodes[id] = data[id];
          nodes[id].id = id;
          nodes[id].children = [];
        }

        // Link parents and children
        for (const id in nodes) {
          const node = nodes[id];
          if (node.parentId) {
            nodes[node.parentId].children.push(node);
          }
        }

        // Find root nodes (no parent)
        const roots = Object.values(nodes).filter(n => !n.parentId);
        treeDiv.innerHTML = "";
        roots.forEach(root => treeDiv.appendChild(createTreeNode(root, nodes)));
      });
    }

    // ðŸ§± Create Tree Node DOM
    function createTreeNode(node, nodes) {
      const div = document.createElement("div");
      div.className = "tree-node";

      const name = document.createElement("strong");
      name.textContent = node.name;
      div.appendChild(name);

      // Display multiple spouses
      if (node.spouseOf) {
        const spousesDiv = document.createElement("div");
        spousesDiv.className = "spouses";
        spousesDiv.innerHTML = "<em>Spouses:</em><br>";

        const spouses = Array.isArray(node.spouseOf) ? node.spouseOf : [node.spouseOf];
        spouses.forEach(spouseId => {
          const spouse = nodes[spouseId];
          if (spouse) {
            const s = document.createElement("div");
            s.className = "spouse";
            s.textContent = spouse.name;
            spousesDiv.appendChild(s);
          }
        });

        div.appendChild(spousesDiv);
      }

      // Add children if any
      if (node.children.length > 0) {
        const childrenDiv = document.createElement("div");
        childrenDiv.className = "tree-children";
        node.children.forEach(child => {
          childrenDiv.appendChild(createTreeNode(child, nodes));
        });
        div.appendChild(childrenDiv);
      }

      return div;
    }
  </script>
</body>
</html>
