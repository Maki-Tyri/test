<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Family Tree Editor</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f9f9f9;
    }

    .tree-container {
      border-left: 2px solid #ccc;
      padding-left: 20px;
    }

    .tree-node {
      position: relative;
      margin-top: 16px;
    }

    .node-header {
      display: flex;
      align-items: center;
      gap: 6px;
      background: #fff;
      padding: 4px 6px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }

    .arrow {
      cursor: pointer;
      font-weight: bold;
      user-select: none;
    }

    .name-input, .birthday-input, .died-input {
      padding: 2px 6px;
      font-size: 14px;
    }

    .node-buttons button {
      font-size: 12px;
      margin-left: 4px;
    }

    .add-child-form, .add-spouse-form {
      margin-top: 6px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .children-container {
      margin-left: 20px;
      border-left: 2px solid #ddd;
      padding-left: 10px;
    }

    /* Spouse styling */
    .spouse-pair {
      display: flex;
      align-items: center;
      gap: 12px;
      position: relative;
      margin-top: 10px;
    }

    .spouse-pair::before {
      content: "";
      position: absolute;
      top: 50%;
      left: 0;
      right: 0;
      height: 2px;
      background: #888;
      z-index: 0;
    }

    .spouse-pair > div {
      background: white;
      z-index: 1;
      padding: 0;
    }

    .spouse-pair .tree-node {
      margin-top: 0;
    }
  </style>
</head>
<body>
  <h2>Family Tree Editor</h2>
  <div id="tree" class="tree-container"></div>

  <script>
    const treeData = {
      root: {
        name: 'Root Person',
        birthday: '',
        died: '',
        children: {},
        spouses: {}
      }
    };

    let nodeIdCounter = 1;

    function renderTree() {
      const treeContainer = document.getElementById('tree');
      treeContainer.innerHTML = '';
      renderNode(treeData.root, treeContainer, 'root', null);
    }

    function renderNode(node, container, nodeId, parentNode) {
      // Handle spouses
      if (Object.keys(node.spouses || {}).length > 0 && parentNode !== null) {
        const spousePairDiv = document.createElement('div');
        spousePairDiv.className = 'spouse-pair';

        const selfDiv = document.createElement('div');
        selfDiv.className = 'tree-node';
        buildNodeContent(node, selfDiv, nodeId, parentNode);
        spousePairDiv.appendChild(selfDiv);

        for (const spouseId in node.spouses) {
          const spouseNode = node.spouses[spouseId];
          const spouseDiv = document.createElement('div');
          spouseDiv.className = 'tree-node';
          buildNodeContent(spouseNode, spouseDiv, spouseId, node);
          spousePairDiv.appendChild(spouseDiv);
        }

        container.appendChild(spousePairDiv);

        // Render children for only one parent (to avoid duplicates)
        const childrenContainer = document.createElement('div');
        childrenContainer.className = 'children-container';
        for (const childId in node.children) {
          const childNode = node.children[childId];
          renderNode(childNode, childrenContainer, childId, node);
        }
        container.appendChild(childrenContainer);
      } else {
        const nodeDiv = document.createElement('div');
        nodeDiv.className = 'tree-node';
        buildNodeContent(node, nodeDiv, nodeId, parentNode);
        container.appendChild(nodeDiv);

        const childrenContainer = document.createElement('div');
        childrenContainer.className = 'children-container';
        for (const childId in node.children) {
          const childNode = node.children[childId];
          renderNode(childNode, childrenContainer, childId, node);
        }
        nodeDiv.appendChild(childrenContainer);
      }
    }

    function buildNodeContent(node, nodeDiv, nodeId, parentNode) {
      const nodeHeader = document.createElement('div');
      nodeHeader.className = 'node-header';

      const arrow = document.createElement('span');
      arrow.className = 'arrow';
      arrow.textContent = Object.keys(node.children).length > 0 ? '▼' : '▶';
      arrow.onclick = () => {
        const childrenDiv = nodeDiv.querySelector('.children-container');
        if (childrenDiv) {
          childrenDiv.style.display = childrenDiv.style.display === 'none' ? 'block' : 'none';
          arrow.textContent = childrenDiv.style.display === 'none' ? '▶' : '▼';
        }
      };
      nodeHeader.appendChild(arrow);

      const nameInput = document.createElement('input');
      nameInput.className = 'name-input';
      nameInput.placeholder = 'Name';
      nameInput.value = node.name;
      nameInput.oninput = (e) => {
        node.name = e.target.value;
      };
      nodeHeader.appendChild(nameInput);

      const birthdayInput = document.createElement('input');
      birthdayInput.className = 'birthday-input';
      birthdayInput.type = 'date';
      birthdayInput.value = node.birthday;
      birthdayInput.oninput = (e) => {
        node.birthday = e.target.value;
      };
      nodeHeader.appendChild(birthdayInput);

      const diedInput = document.createElement('input');
      diedInput.className = 'died-input';
      diedInput.type = 'date';
      diedInput.value = node.died || '';
      diedInput.placeholder = 'Died';
      diedInput.oninput = (e) => {
        node.died = e.target.value;
      };
      nodeHeader.appendChild(diedInput);

      const nodeButtons = document.createElement('div');
      nodeButtons.className = 'node-buttons';

      const addChildBtn = document.createElement('button');
      addChildBtn.textContent = 'Add Child';
      addChildBtn.onclick = () => {
        const childId = `node${nodeIdCounter++}`;
        node.children[childId] = {
          name: '',
          birthday: '',
          died: '',
          children: {},
          spouses: {}
        };
        renderTree();
      };
      nodeButtons.appendChild(addChildBtn);

      const addSpouseBtn = document.createElement('button');
      addSpouseBtn.textContent = 'Add Spouse';
      addSpouseBtn.onclick = () => {
        const spouseId = `spouse${nodeIdCounter++}`;
        node.spouses[spouseId] = {
          name: '',
          birthday: '',
          died: '',
          children: {},
          spouses: {}
        };
        renderTree();
      };
      nodeButtons.appendChild(addSpouseBtn);

      if (parentNode) {
        const deleteBtn = document.createElement('button');
        deleteBtn.textContent = 'Delete';
        deleteBtn.onclick = () => {
          delete parentNode.children[nodeId];
          renderTree();
        };
        nodeButtons.appendChild(deleteBtn);
      }

      nodeHeader.appendChild(nodeButtons);
      nodeDiv.appendChild(nodeHeader);
    }

    renderTree();
  </script>
</body>
</html>
