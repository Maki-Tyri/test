<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Family Tree App with Firebase Auth</title>
<style>
  body, html {
    height: 100%;
    margin: 0;
    font-family: Arial, sans-serif;
    background: #eef2f5;
  }
  #login-page, #app {
    height: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
  }
  #login-page {
    flex-direction: column;
    background: rgba(255 255 255 / 0.3);
    backdrop-filter: blur(8px);
    box-shadow: 0 0 20px rgba(0,0,0,0.1);
    border-radius: 12px;
    padding: 40px;
    max-width: 320px;
    margin: auto;
  }
  input {
    width: 100%;
    padding: 12px;
    margin: 8px 0;
    border-radius: 8px;
    border: 1px solid #ccc;
    font-size: 16px;
  }
  button {
    cursor: pointer;
    background-color: #1976d2;
    color: white;
    border: none;
    padding: 12px;
    width: 100%;
    border-radius: 8px;
    font-size: 16px;
    margin-top: 10px;
  }
  button#signup-btn {
    background-color: #28a745;
  }
  #login-error {
    color: #f44336;
    margin-top: 10px;
    display: none;
    font-weight: 600;
  }
  #app {
    display: none;
    flex-direction: column;
    height: 100%;
  }
  #container {
    flex: 1;
    display: flex;
    overflow-y: auto;
    padding: 20px;
    gap: 20px;
  }
  #family-tree, #member-details {
    background: white;
    border-radius: 12px;
    box-shadow: 0 0 10px rgb(0 0 0 / 0.1);
    padding: 20px;
    flex-grow: 1;
  }
  #family-tree {
    max-width: 400px;
    overflow-y: auto;
  }
  .member {
    margin: 10px 0;
    cursor: pointer;
  }
  .member.selected {
    background-color: #1976d2;
    color: white;
    border-radius: 6px;
    padding: 4px 8px;
  }
  #add-root-member-btn {
    margin: 20px;
    align-self: center;
    padding: 12px 24px;
    border-radius: 8px;
  }
  footer {
    position: fixed;
    bottom: 0;
    width: 100%;
    background: rgba(255 255 255 / 0.2);
    backdrop-filter: blur(6px);
    text-align: center;
    padding: 10px 0;
    font-size: 14px;
    color: #555;
    border-top: 1px solid rgba(0,0,0,0.1);
  }
</style>
</head>
<body>

<div id="login-page">
  <h2>Login to Family Tree</h2>
  <input id="username" type="email" placeholder="Email" />
  <input id="password" type="password" placeholder="Password" />
  <button id="login-btn">Login</button>
  <button id="signup-btn">Sign Up</button>
  <div id="login-error"></div>
</div>

<div id="app">
  <button id="add-root-member-btn">+ Add Root Member</button>
  <div id="container">
    <div id="family-tree"></div>
    <div id="member-details">
      <h3>Member Details</h3>
      <div id="details-content">Select a member to view details</div>
    </div>
  </div>
</div>

<footer>
  Family Tree App &copy; 2025
</footer>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>

<script>
  // Your Firebase config
  const firebaseConfig = {
  apiKey: "AIzaSyCy9CKJ6CELheBhw7Gs0BgsE1E0FsoYdgU",
  authDomain: "project-955237504610034331.firebaseapp.com",
  databaseURL: "https://project-955237504610034331-default-rtdb.firebaseio.com",
  projectId: "project-955237504610034331",
  storageBucket: "project-955237504610034331.firebasestorage.app",
  messagingSenderId: "76212939677",
  appId: "1:76212939677:web:cc36cc1cadfd106b6e5d74",
  measurementId: "G-RCJ4P82PVM"
};

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
  const auth = firebase.auth();

  const loginPage = document.getElementById('login-page');
  const app = document.getElementById('app');
  const loginBtn = document.getElementById('login-btn');
  const signupBtn = document.getElementById('signup-btn');
  const loginError = document.getElementById('login-error');
  const addRootBtn = document.getElementById('add-root-member-btn');

  const familyTreeDiv = document.getElementById('family-tree');
  const detailsContent = document.getElementById('details-content');

  let selectedMemberId = null;
  let familyTreeData = {};

  // Auth state listener
  auth.onAuthStateChanged(user => {
    if (user) {
      loginPage.style.display = 'none';
      app.style.display = 'flex';
      startApp();
    } else {
      loginPage.style.display = 'flex';
      app.style.display = 'none';
      clearUI();
    }
  });

  // Login
  loginBtn.addEventListener('click', () => {
    const email = document.getElementById('username').value.trim();
    const password = document.getElementById('password').value.trim();
    loginError.style.display = 'none';

    auth.signInWithEmailAndPassword(email, password)
      .catch(error => {
        loginError.style.color = '#f44336';
        loginError.textContent = error.message;
        loginError.style.display = 'block';
      });
  });

  // Sign Up
  signupBtn.addEventListener('click', () => {
    const email = document.getElementById('username').value.trim();
    const password = document.getElementById('password').value.trim();
    loginError.style.display = 'none';

    auth.createUserWithEmailAndPassword(email, password)
      .then(() => {
        loginError.style.color = '#28a745';
        loginError.textContent = 'Account created! Please login.';
        loginError.style.display = 'block';
      })
      .catch(error => {
        loginError.style.color = '#f44336';
        loginError.textContent = error.message;
        loginError.style.display = 'block';
      });
  });

  // Add Root Member
  addRootBtn.addEventListener('click', () => {
    const newMemberRef = db.ref('familyTree').push();
    const newMemberId = newMemberRef.key;

    const newMember = {
      name: 'New Root Member',
      birthdate: '',
      alive: true,
      spouses: {},
      children: {}
    };

    newMemberRef.set(newMember);
  });

  // Start the app
  function startApp() {
    // Listen to familyTree changes
    db.ref('familyTree').on('value', snapshot => {
      familyTreeData = snapshot.val() || {};
      renderFamilyTree();
      if (selectedMemberId && familyTreeData[selectedMemberId]) {
        showMemberDetails(selectedMemberId);
      } else {
        detailsContent.innerHTML = 'Select a member to view details';
      }
    });
  }

  // Render family tree list
  function renderFamilyTree() {
    familyTreeDiv.innerHTML = '';
    for (const id in familyTreeData) {
      const member = familyTreeData[id];
      const memberDiv = document.createElement('div');
      memberDiv.classList.add('member');
      if (id === selectedMemberId) memberDiv.classList.add('selected');
      memberDiv.textContent = member.name || '(No name)';
      memberDiv.onclick = () => {
        selectedMemberId = id;
        renderFamilyTree();
        showMemberDetails(id);
      };
      familyTreeDiv.appendChild(memberDiv);
    }
  }

  // Show member details and buttons to add spouse/child
  function showMemberDetails(memberId) {
    const member = familyTreeData[memberId];
    if (!member) return;
    selectedMemberId = memberId;

    let html = `
      <p><strong>Name:</strong> ${member.name || ''}</p>
      <p><strong>Birthdate:</strong> ${member.birthdate || ''}</p>
      <p><strong>Alive:</strong> ${member.alive ? 'Yes' : 'No'}</p>
      <h4>Spouses:</h4>
      <ul>
    `;

    if (member.spouses) {
      for (const spId in member.spouses) {
        html += `<li>${member.spouses[spId].name || '(No name)'}</li>`;
      }
    }
    html += '</ul><h4>Children:</h4><ul>';

    if (member.children) {
      for (const chId in member.children) {
        html += `<li>${member.children[chId].name || '(No name)'}</li>`;
      }
    }
    html += `</ul>`;

    html += `
      <button id="add-spouse-btn">+ Add Spouse</button>
      <button id="add-child-btn">+ Add Child</button>
    `;

    detailsContent.innerHTML = html;

    document.getElementById('add-spouse-btn').onclick = () => addSpouse(memberId);
    document.getElementById('add-child-btn').onclick = () => addChild(memberId);
  }

  // Add spouse function
  function addSpouse(memberId) {
    const spouseRef = db.ref(`familyTree/${memberId}/spouses`).push();
    const spouseId = spouseRef.key;
    const newSpouse = {
      name: 'New Spouse',
      birthdate: '',
      alive: true,
      spouses: {},
      children: {}
    };
    spouseRef.set(newSpouse);
  }

  // Add child function
  function addChild(memberId) {
    const childRef = db.ref(`familyTree/${memberId}/children`).push();
    const childId = childRef.key;
    const newChild = {
      name: 'New Child',
      birthdate: '',
      alive: true,
      spouses: {},
      children: {}
    };
    childRef.set(newChild);
  }

  // Clear UI on logout
  function clearUI() {
    familyTreeDiv.innerHTML = '';
    detailsContent.innerHTML = 'Select a member to view details';
    selectedMemberId = null;
    familyTreeData = {};
  }
</script>
</body>
</html>
