<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Family Tree App with Side Connections & Login</title>
<style>
  /* Reset & base */
  * {
    box-sizing: border-box;
  }
  body, html {
    margin: 0; padding: 0; height: 100%;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #e0f0ff, #ffffff);
    display: flex;
    flex-direction: column;
    min-height: 100vh;
  }

  /* ----- LOGIN PAGE ----- */
  #login-page {
    flex: 1;
    display: none;
    justify-content: center;
    align-items: center;
    padding: 20px;
  }
  #login-page.active {
    display: flex;
  }
  .login-container {
    background: rgba(255 255 255 / 0.15);
    backdrop-filter: blur(15px);
    border-radius: 15px;
    padding: 30px 40px;
    max-width: 380px;
    width: 100%;
    box-shadow: 0 8px 32px rgba(0,0,0,0.12);
    color: #003366;
  }
  .login-container h2 {
    margin-bottom: 24px;
    font-weight: 700;
    text-align: center;
  }
  .login-container label {
    display: block;
    margin-bottom: 6px;
    font-weight: 600;
  }
  .login-container input[type="text"],
  .login-container input[type="password"] {
    width: 100%;
    padding: 10px 12px;
    margin-bottom: 18px;
    border-radius: 8px;
    border: none;
    outline: none;
    font-size: 16px;
    background: rgba(255 255 255 / 0.6);
    box-shadow: inset 1px 1px 4px rgba(0,0,0,0.1);
    transition: background 0.3s ease;
  }
  .login-container input[type="text"]:focus,
  .login-container input[type="password"]:focus {
    background: rgba(255 255 255 / 0.85);
  }
  .login-container button {
    width: 100%;
    padding: 12px;
    font-weight: 700;
    font-size: 18px;
    color: white;
    background: #007bff;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    box-shadow: 0 4px 12px rgba(0,123,255,0.6);
    transition: background 0.3s ease;
  }
  .login-container button:hover {
    background: #0056b3;
  }

  /* ----- FAMILY TREE APP ----- */
  #app-container {
    flex: 1;
    display: none;
    padding: 20px;
    overflow-x: auto;
    background: #f8fbff;
  }
  #app-container.active {
    display: block;
  }

  .family-tree-wrapper {
    display: flex;
    justify-content: center;
  }

  .family-tree {
    display: flex;
    flex-direction: column;
    gap: 24px;
    min-width: 280px;
    max-width: 100%;
  }

  /* Nodes container with flexible growth */
  .tree-node {
    background: white;
    border-radius: 12px;
    padding: 12px 16px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    min-width: 260px;
    max-width: 320px;
    position: relative;
    display: flex;
    flex-direction: column;
    gap: 8px;
  }
  /* Responsive container grows with content */
  .tree-node input[type="text"], 
  .tree-node input[type="date"] {
    width: 100%;
    padding: 6px 8px;
    border-radius: 6px;
    border: 1px solid #ccc;
    font-size: 14px;
  }
  .tree-node input[type="checkbox"] {
    transform: scale(1.2);
    margin-right: 6px;
    cursor: pointer;
  }

  .node-header {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: 8px;
  }

  .node-buttons {
    margin-left: auto;
    display: flex;
    gap: 6px;
  }
  .node-buttons button {
    cursor: pointer;
    background: #007bff;
    border: none;
    color: white;
    padding: 4px 8px;
    font-size: 13px;
    border-radius: 6px;
    transition: background 0.2s ease;
  }
  .node-buttons button:hover {
    background: #0056b3;
  }
  .node-buttons .delete-btn {
    background: #dc3545;
  }
  .node-buttons .delete-btn:hover {
    background: #a71d2a;
  }

  /* Spouses side by side with horizontal connector */
  .spouses-container {
    display: flex;
    gap: 16px;
    position: relative;
    margin-top: 8px;
  }
  .spouse-node {
    background: #f3f7ff;
    border: 1.5px solid #007bff;
    min-width: 220px;
  }
  .spouse-connector {
    position: absolute;
    top: 14px;
    left: 0;
    right: 0;
    height: 2px;
    background: #007bff;
    z-index: 0;
  }

  /* Children vertical container */
  .children-container {
    margin-top: 16px;
    border-left: 3px solid #007bff;
    padding-left: 16px;
    display: flex;
    flex-direction: column;
    gap: 24px;
    position: relative;
  }

  /* Connectors on left side */
  svg.connector-svg {
    position: absolute;
    top: 0; left: 0;
    pointer-events: none;
    overflow: visible;
    z-index: 10;
  }

  /* Connectors lines styling */
  line {
    stroke: #007bff;
    stroke-width: 2;
  }

  /* Footer fixed & glass style */
  footer {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: rgba(255 255 255 / 0.15);
    backdrop-filter: blur(12px);
    color: #003366;
    font-weight: 600;
    text-align: center;
    padding: 10px 0;
    font-size: 14px;
    user-select: none;
    z-index: 1000;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
  }

  /* Responsive tweaks */
  @media (max-width: 768px) {
    .tree-node, .spouse-node {
      min-width: 100%;
      max-width: 100%;
    }
    .family-tree-wrapper {
      padding-bottom: 50px; /* For footer space */
    }
  }
</style>
</head>
<body>

<!-- LOGIN PAGE -->
<div id="login-page" class="active">
  <div class="login-container">
    <h2>Login to Family Tree</h2>
    <form id="login-form">
      <label for="username">Username</label>
      <input id="username" type="text" required autocomplete="username" />
      <label for="password">Password</label>
      <input id="password" type="password" required autocomplete="current-password" />
      <button type="submit">Login</button>
    </form>
  </div>
</div>

<!-- FAMILY TREE APP -->
<div id="app-container">
  <div class="family-tree-wrapper">
    <div id="family-tree" class="family-tree"></div>
  </div>
</div>

<footer>&copy; 2025 Maki Web. All rights reserved</footer>

<script>
  // Simple login toggle - for demo only, no backend/auth
  const loginPage = document.getElementById('login-page');
  const appContainer = document.getElementById('app-container');
  const loginForm = document.getElementById('login-form');

  loginForm.addEventListener('submit', e => {
    e.preventDefault();
    // You can add validation here if needed
    loginPage.classList.remove('active');
    appContainer.classList.add('active');
    renderFamilyTrees();
  });

  // Family tree data structure
  let familyTrees = {};

  // Load from localStorage if exists
  function loadFamilyTrees() {
    const data = localStorage.getItem('familyTrees');
    if (data) familyTrees = JSON.parse(data);
    else {
      // If empty, create a root sample person for demo
      const rootId = 'root';
      familyTrees[rootId] = {
        id: rootId,
        name: 'Root Person',
        birthday: '',
        died: false,
        diedDate: '',
        children: {},
        spouses: {}
      };
    }
  }

  function saveFamilyTrees() {
    localStorage.setItem('familyTrees', JSON.stringify(familyTrees));
  }

  // Main render function
  function renderFamilyTrees() {
    const treeContainer = document.getElementById('family-tree');
    treeContainer.innerHTML = '';
    loadFamilyTrees();

    for (const rootId in familyTrees) {
      renderNode(familyTrees[rootId], treeContainer, rootId, null);
    }
  }

  // Create SVG line helper for left side connectors
  function createLine(svg, x1, y1, x2, y2) {
    const ns = "http://www.w3.org/2000/svg";
    const line = document.createElementNS(ns, "line");
    line.setAttribute("x1", x1);
    line.setAttribute("y1", y1);
    line.setAttribute("x2", x2);
    line.setAttribute("y2", y2);
    line.setAttribute("stroke", "#007bff");
    line.setAttribute("stroke-width", "2");
    return line;
  }

  // Recursive render node (person)
  function renderNode(node, parentDiv, nodeId, parentNodeDiv) {
    const nodeDiv = document.createElement('div');
    nodeDiv.className = 'tree-node';
    nodeDiv.dataset.id = nodeId;

    // Header with inputs
    const header = document.createElement('div');
    header.className = 'node-header';

    const nameInput = document.createElement('input');
    nameInput.type = 'text';
    nameInput.value = node.name;
    nameInput.title = "Name";
    header.appendChild(nameInput);

    const birthdayInput = document.createElement('input');
    birthdayInput.type = 'date';
    birthdayInput.value = node.birthday || '';
    birthdayInput.title = "Birthday";
    header.appendChild(birthdayInput);

    const diedCheckbox = document.createElement('input');
    diedCheckbox.type = 'checkbox';
    diedCheckbox.checked = node.died || false;
    diedCheckbox.title = "Died";
    header.appendChild(diedCheckbox);

    const diedDateInput = document.createElement('input');
    diedDateInput.type = 'date';
    diedDateInput.value = node.diedDate || '';
    diedDateInput.style.display = diedCheckbox.checked ? 'inline-block' : 'none';
    diedDateInput.title = "Date of Death";
    diedDateInput.style.marginLeft = '8px';
    header.appendChild(diedDateInput);

    diedCheckbox.addEventListener('change', () => {
      diedDateInput.style.display = diedCheckbox.checked ? 'inline-block' : 'none';
      node.died = diedCheckbox.checked;
      if (!node.died) node.diedDate = '';
      saveAndRender();
    });
    diedDateInput.addEventListener('change', () => {
      node.diedDate = diedDateInput.value;
      saveAndRender();
    });

    // Save changes on name/birthday inputs
    nameInput.addEventListener('input', () => {
      node.name = nameInput.value;
      saveAndRender();
    });
    birthdayInput.addEventListener('change', () => {
      node.birthday = birthdayInput.value;
      saveAndRender();
    });

    // Buttons: add spouse, add child, delete node
    const btnContainer = document.createElement('div');
    btnContainer.className = 'node-buttons';

    const addSpouseBtn = document.createElement('button');
    addSpouseBtn.textContent = '+ Spouse';
    addSpouseBtn.title = 'Add Spouse';
    addSpouseBtn.addEventListener('click', () => {
      const spouseId = generateId();
      node.spouses[spouseId] = {
        id: spouseId,
        name: '',
        birthday: '',
        died: false,
        diedDate: '',
        children: {},
        spouses: {}
      };
      saveAndRender();
    });

    const addChildBtn = document.createElement('button');
    addChildBtn.textContent = '+ Child';
    addChildBtn.title = 'Add Child';
    addChildBtn.addEventListener('click', () => {
      const childId = generateId();
      node.children[childId] = {
        id: childId,
        name: '',
        birthday: '',
        died: false,
        diedDate: '',
        children: {},
        spouses: {}
      };
      saveAndRender();
    });

    const deleteBtn = document.createElement('button');
    deleteBtn.textContent = 'Delete';
    deleteBtn.className = 'delete-btn';
    deleteBtn.title = 'Delete Member';
    deleteBtn.addEventListener('click', () => {
      if (confirm(`Delete ${node.name || 'this member'}?`)) {
        deleteNodeById(nodeId);
        saveAndRender();
      }
    });

    btnContainer.appendChild(addSpouseBtn);
    btnContainer.appendChild(addChildBtn);
    btnContainer.appendChild(deleteBtn);

    header.appendChild(btnContainer);
    nodeDiv.appendChild(header);

    // Spouses container (side by side)
    if (Object.keys(node.spouses).length > 0) {
      const spousesDiv = document.createElement('div');
      spousesDiv.className = 'spouses-container';

      // Add connector line between spouses
      const spouseLine = document.createElement('div');
      spouseLine.className = 'spouse-connector';
      spousesDiv.appendChild(spouseLine);

      for (const spouseId in node.spouses) {
        const spouseNode = node.spouses[spouseId];
        const spouseDiv = document.createElement('div');
        spouseDiv.className = 'tree-node spouse-node';
        spouseDiv.dataset.id = spouseId;

        // Spouse inputs (same as main node)
        const spouseHeader = document.createElement('div');
        spouseHeader.className = 'node-header';

        const sNameInput = document.createElement('input');
        sNameInput.type = 'text';
        sNameInput.value = spouseNode.name;
        sNameInput.title = "Name";
        spouseHeader.appendChild(sNameInput);

        const sBirthdayInput = document.createElement('input');
        sBirthdayInput.type = 'date';
        sBirthdayInput.value = spouseNode.birthday || '';
        sBirthdayInput.title = "Birthday";
        spouseHeader.appendChild(sBirthdayInput);

        const sDiedCheckbox = document.createElement('input');
        sDiedCheckbox.type = 'checkbox';
        sDiedCheckbox.checked = spouseNode.died || false;
        sDiedCheckbox.title = "Died";
        spouseHeader.appendChild(sDiedCheckbox);

        const sDiedDateInput = document.createElement('input');
        sDiedDateInput.type = 'date';
        sDiedDateInput.value = spouseNode.diedDate || '';
        sDiedDateInput.style.display = sDiedCheckbox.checked ? 'inline-block' : 'none';
        sDiedDateInput.title = "Date of Death";
        sDiedDateInput.style.marginLeft = '8px';
        spouseHeader.appendChild(sDiedDateInput);

        sDiedCheckbox.addEventListener('change', () => {
          sDiedDateInput.style.display = sDiedCheckbox.checked ? 'inline-block' : 'none';
          spouseNode.died = sDiedCheckbox.checked;
          if (!spouseNode.died) spouseNode.diedDate = '';
          saveAndRender();
        });
        sDiedDateInput.addEventListener('change', () => {
          spouseNode.diedDate = sDiedDateInput.value;
          saveAndRender();
        });

        sNameInput.addEventListener('input', () => {
          spouseNode.name = sNameInput.value;
          saveAndRender();
        });
        sBirthdayInput.addEventListener('change', () => {
          spouseNode.birthday = sBirthdayInput.value;
          saveAndRender();
        });

        // Buttons for spouse: add child and delete spouse
        const spouseBtnContainer = document.createElement('div');
        spouseBtnContainer.className = 'node-buttons';

        const addSpouseChildBtn = document.createElement('button');
        addSpouseChildBtn.textContent = '+ Child';
        addSpouseChildBtn.title = 'Add Child';
        addSpouseChildBtn.addEventListener('click', () => {
          const childId = generateId();
          spouseNode.children[childId] = {
            id: childId,
            name: '',
            birthday: '',
            died: false,
            diedDate: '',
            children: {},
            spouses: {}
          };
          saveAndRender();
        });

        const deleteSpouseBtn = document.createElement('button');
        deleteSpouseBtn.textContent = 'Delete';
        deleteSpouseBtn.className = 'delete-btn';
        deleteSpouseBtn.title = 'Delete Spouse';
        deleteSpouseBtn.addEventListener('click', () => {
          if (confirm(`Delete spouse ${spouseNode.name || ''}?`)) {
            deleteSpouse(node, spouseId);
            saveAndRender();
          }
        });

        spouseBtnContainer.appendChild(addSpouseChildBtn);
        spouseBtnContainer.appendChild(deleteSpouseBtn);

        spouseHeader.appendChild(spouseBtnContainer);
        spouseDiv.appendChild(spouseHeader);

        // Spouse children container
        if (Object.keys(spouseNode.children).length > 0) {
          const spouseChildrenDiv = document.createElement('div');
          spouseChildrenDiv.className = 'children-container';
          for (const cId in spouseNode.children) {
            renderNode(spouseNode.children[cId], spouseChildrenDiv, cId, spouseDiv);
          }
          spouseDiv.appendChild(spouseChildrenDiv);
        }

        spousesDiv.appendChild(spouseDiv);
      }
      nodeDiv.appendChild(spousesDiv);
    }

    // Children container (vertical)
    if (Object.keys(node.children).length > 0) {
      const childrenDiv = document.createElement('div');
      childrenDiv.className = 'children-container';
      for (const childId in node.children) {
        renderNode(node.children[childId], childrenDiv, childId, nodeDiv);
      }
      nodeDiv.appendChild(childrenDiv);
    }

    parentDiv.appendChild(nodeDiv);

    // After node rendered, draw left side connectors to children and spouses
    setTimeout(() => {
      drawConnections(nodeDiv);
    }, 0);
  }

  // Delete node by id in the whole tree
  function deleteNodeById(id) {
    function recursiveDelete(obj) {
      if (obj.children && obj.children[id]) {
        delete obj.children[id];
        return true;
      }
      if (obj.spouses && obj.spouses[id]) {
        delete obj.spouses[id];
        return true;
      }
      for (const key in obj.children) {
        if (recursiveDelete(obj.children[key])) return true;
      }
      for (const key in obj.spouses) {
        if (recursiveDelete(obj.spouses[key])) return true;
      }
      return false;
    }
    if (familyTrees[id]) {
      delete familyTrees[id];
    } else {
      for (const rootId in familyTrees) {
        if (recursiveDelete(familyTrees[rootId])) break;
      }
    }
  }

  // Delete spouse from a node
  function deleteSpouse(parentNode, spouseId) {
    if (parentNode.spouses && parentNode.spouses[spouseId]) {
      delete parentNode.spouses[spouseId];
    }
  }

  // Generate simple unique id
  function generateId() {
    return 'id_' + Math.random().toString(36).substr(2, 9);
  }

  // Save and re-render
  function saveAndRender() {
    saveFamilyTrees();
    renderFamilyTrees();
  }

  // Draw connectors on left side from node to children and spouses
  function drawConnections(nodeDiv) {
    // Remove old svg connector if any
    const oldSvg = nodeDiv.querySelector('svg.connector-svg');
    if (oldSvg) oldSvg.remove();

    const childrenContainer = nodeDiv.querySelector('.children-container');
    const spousesContainer = nodeDiv.querySelector('.spouses-container');

    if (!childrenContainer && !spousesContainer) return;

    const ns = "http://www.w3.org/2000/svg";
    const svg = document.createElementNS(ns, "svg");
    svg.classList.add('connector-svg');
    nodeDiv.appendChild(svg);

    const parentRect = nodeDiv.getBoundingClientRect();

    // We position svg absolutely relative to nodeDiv:
    // set width/height to cover vertical height needed and width left side for lines.
    let totalHeight = nodeDiv.offsetHeight;
    let maxWidth = 40; // space on left side for connector lines

    svg.style.width = maxWidth + 'px';
    svg.style.height = totalHeight + 'px';
    svg.style.left = '-40px';
    svg.style.top = '0px';

    // Coordinates relative to SVG for lines
    // Connect from left center of nodeDiv (x=40) vertically to each child's top left

    // Starting point: vertical center of nodeDiv left edge
    const startX = maxWidth;
    const startY = nodeDiv.offsetHeight / 2;

    // Draw vertical line from parent node center left side down through children
    if (childrenContainer) {
      // For each child, draw a horizontal line from svg left side to child node's left edge,
      // and a vertical line connecting parent center to children top positions.

      const children = Array.from(childrenContainer.children);

      // Compute children positions relative to nodeDiv
      const childrenPos = children.map(c => c.offsetTop + c.offsetHeight / 2);

      // Draw main vertical line from startY to last child's center Y
      const minY = Math.min(...childrenPos);
      const maxY = Math.max(...childrenPos);

      // Vertical main line from parent center left edge to span children centers
      const mainLine = document.createElementNS(ns, "line");
      mainLine.setAttribute('x1', startX);
      mainLine.setAttribute('y1', startY);
      mainLine.setAttribute('x2', startX);
      mainLine.setAttribute('y2', minY);
      mainLine.setAttribute('stroke', '#007bff');
      mainLine.setAttribute('stroke-width', '2');
      svg.appendChild(mainLine);

      if (minY !== maxY) {
        const verticalSpanLine = document.createElementNS(ns, "line");
        verticalSpanLine.setAttribute('x1', startX);
        verticalSpanLine.setAttribute('y1', minY);
        verticalSpanLine.setAttribute('x2', startX);
        verticalSpanLine.setAttribute('y2', maxY);
        verticalSpanLine.setAttribute('stroke', '#007bff');
        verticalSpanLine.setAttribute('stroke-width', '2');
        svg.appendChild(verticalSpanLine);
      }

      // Horizontal connectors from main vertical line to each child
      childrenPos.forEach(y => {
        const hLine = document.createElementNS(ns, "line");
        hLine.setAttribute('x1', startX);
        hLine.setAttribute('y1', y);
        hLine.setAttribute('x2', 0);
        hLine.setAttribute('y2', y);
        hLine.setAttribute('stroke', '#007bff');
        hLine.setAttribute('stroke-width', '2');
        svg.appendChild(hLine);
      });
    }

    // Draw connectors for spouses horizontally (line connecting spouses)
    if (spousesContainer) {
      // The spousesContainer is inside nodeDiv, so no extra connector lines needed besides the one between spouses
      // But let's draw a vertical line from parent's center to spouses line

      const spousesLineY = spousesContainer.offsetTop + spousesContainer.offsetHeight / 2;

      const verticalLine = document.createElementNS(ns, "line");
      verticalLine.setAttribute('x1', startX);
      verticalLine.setAttribute('y1', startY);
      verticalLine.setAttribute('x2', startX);
      verticalLine.setAttribute('y2', spousesLineY);
      verticalLine.setAttribute('stroke', '#007bff');
      verticalLine.setAttribute('stroke-width', '2');
      svg.appendChild(verticalLine);

      // Also horizontal line from left svg edge to spouses line vertical connector
      const hLineSpouse = document.createElementNS(ns, "line");
      hLineSpouse.setAttribute('x1', 0);
      hLineSpouse.setAttribute('y1', spousesLineY);
      hLineSpouse.setAttribute('x2', startX);
      hLineSpouse.setAttribute('y2', spousesLineY);
      hLineSpouse.setAttribute('stroke', '#007bff');
      hLineSpouse.setAttribute('stroke-width', '2');
      svg.appendChild(hLineSpouse);
    }
  }

</script>

</body>
</html>
