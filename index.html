<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Indented Vertical Family Tree</title>
<style>
  body {
    margin: 0;
    font-family: Arial, sans-serif;
    overflow: hidden;
  }
  #app {
    display: flex;
    flex-direction: column;
    height: 100vh;
  }
  #search-bar {
    background: #eee;
    padding: 10px;
    position: sticky;
    top: 0;
    z-index: 1000;
    display: flex;
    align-items: center;
    gap: 10px;
  }
  #search-input {
    flex-grow: 1;
    padding: 6px 8px;
    font-size: 16px;
  }
  #add-root-btn {
    padding: 6px 12px;
    font-size: 16px;
    cursor: pointer;
  }
  #tree-container {
    flex-grow: 1;
    overflow: auto;
    padding: 10px 20px;
    background: #fafafa;
  }
  .node {
    background: white;
    border: 1px solid #aaa;
    border-radius: 6px;
    padding: 8px 12px;
    margin: 6px 0;
    position: relative;
    min-width: 250px;
    box-shadow: 1px 1px 5px rgba(0,0,0,0.1);
  }
  .node.highlight {
    border-color: #f39c12;
    box-shadow: 0 0 10px #f39c12;
  }
  .node .info-row {
    display: flex;
    gap: 8px;
    margin-bottom: 4px;
  }
  .node label {
    font-weight: bold;
    flex-shrink: 0;
    width: 60px;
  }
  .node input[type="text"],
  .node input[type="date"] {
    flex-grow: 1;
    border: 1px solid #ccc;
    border-radius: 3px;
    padding: 2px 6px;
    font-size: 14px;
  }
  .node .controls {
    margin-top: 8px;
  }
  .node .controls button {
    margin-right: 8px;
    padding: 4px 8px;
    font-size: 13px;
    cursor: pointer;
  }
  .children {
    margin-left: 30px;
    border-left: 2px solid #bbb;
    padding-left: 20px;
  }
  .toggle-collapse {
    position: absolute;
    top: 6px;
    right: 6px;
    cursor: pointer;
    font-size: 16px;
    user-select: none;
    background: #eee;
    border-radius: 4px;
    width: 22px;
    height: 22px;
    line-height: 20px;
    text-align: center;
  }
</style>
</head>
<body>
<div id="app">
  <div id="search-bar">
    <input type="text" id="search-input" placeholder="Search name..." />
    <button id="add-root-btn">Add Root</button>
  </div>
  <div id="tree-container" tabindex="0"></div>
</div>

<script>
  const treeContainer = document.getElementById("tree-container");
  const searchInput = document.getElementById("search-input");
  const addRootBtn = document.getElementById("add-root-btn");

  // Data structure
  // Each node: { id, name, birthday, death, spouseId, childrenIds, parentId, collapsed }
  let nodes = {};
  let roots = [];
  let idCounter = 0;

  function createNode(parentId = null) {
    const id = "node-" + (idCounter++);
    nodes[id] = {
      id,
      name: "",
      birthday: "",
      death: "",
      spouseId: null,
      childrenIds: [],
      parentId,
      collapsed: false,
    };
    if (parentId === null) {
      roots.push(id);
    } else {
      nodes[parentId].childrenIds.push(id);
    }
    return id;
  }

  function createNodeElement(nodeId) {
    const node = nodes[nodeId];

    const nodeEl = document.createElement("div");
    nodeEl.className = "node";
    nodeEl.dataset.id = nodeId;

    // Collapse toggle button
    const toggleBtn = document.createElement("div");
    toggleBtn.className = "toggle-collapse";
    toggleBtn.textContent = node.collapsed ? "+" : "âˆ’";
    toggleBtn.title = node.collapsed ? "Expand" : "Collapse";
    toggleBtn.onclick = (e) => {
      e.stopPropagation();
      node.collapsed = !node.collapsed;
      renderTree();
    };
    nodeEl.appendChild(toggleBtn);

    // Input fields
    const nameRow = document.createElement("div");
    nameRow.className = "info-row";
    const nameLabel = document.createElement("label");
    nameLabel.textContent = "Name:";
    const nameInput = document.createElement("input");
    nameInput.type = "text";
    nameInput.value = node.name;
    nameInput.placeholder = "Name";
    nameInput.oninput = (e) => {
      node.name = e.target.value;
      renderTree();
    };
    nameRow.appendChild(nameLabel);
    nameRow.appendChild(nameInput);

    const birthdayRow = document.createElement("div");
    birthdayRow.className = "info-row";
    const birthdayLabel = document.createElement("label");
    birthdayLabel.textContent = "Birthday:";
    const birthdayInput = document.createElement("input");
    birthdayInput.type = "date";
    birthdayInput.value = node.birthday;
    birthdayInput.oninput = (e) => {
      node.birthday = e.target.value;
    };
    birthdayRow.appendChild(birthdayLabel);
    birthdayRow.appendChild(birthdayInput);

    const deathRow = document.createElement("div");
    deathRow.className = "info-row";
    const deathLabel = document.createElement("label");
    deathLabel.textContent = "Death:";
    const deathInput = document.createElement("input");
    deathInput.type = "date";
    deathInput.value = node.death;
    deathInput.oninput = (e) => {
      node.death = e.target.value;
    };
    deathRow.appendChild(deathLabel);
    deathRow.appendChild(deathInput);

    nodeEl.appendChild(nameRow);
    nodeEl.appendChild(birthdayRow);
    nodeEl.appendChild(deathRow);

    // Controls
    const controls = document.createElement("div");
    controls.className = "controls";

    const addSpouseBtn = document.createElement("button");
    addSpouseBtn.textContent = "Add Spouse";
    addSpouseBtn.onclick = () => {
      if (node.spouseId) {
        alert("Spouse already exists!");
        return;
      }
      const spouseId = createNode(node.parentId);
      nodes[spouseId].spouseId = nodeId;
      node.spouseId = spouseId;
      renderTree();
    };
    controls.appendChild(addSpouseBtn);

    const addChildBtn = document.createElement("button");
    addChildBtn.textContent = "Add Child";
    addChildBtn.onclick = () => {
      if (node.collapsed) {
        node.collapsed = false; // auto expand on add child
      }
      createNode(nodeId);
      renderTree();
    };
    controls.appendChild(addChildBtn);

    nodeEl.appendChild(controls);

    return nodeEl;
  }

  function renderNode(nodeId) {
    const node = nodes[nodeId];
    const nodeEl = createNodeElement(nodeId);

    const container = document.createElement("div");
    container.appendChild(nodeEl);

    // If spouse exists, render spouse side by side
    if (node.spouseId && nodes[node.spouseId]) {
      const spouseEl = createNodeElement(node.spouseId);
      spouseEl.style.marginLeft = "20px";
      container.firstChild.style.display = "inline-block";
      spouseEl.style.display = "inline-block";
      container.appendChild(spouseEl);
    }

    // If collapsed, don't render children
    if (!node.collapsed && node.childrenIds.length > 0) {
      const childrenContainer = document.createElement("div");
      childrenContainer.className = "children";
      for (const childId of node.childrenIds) {
        childrenContainer.appendChild(renderNode(childId));
      }
      container.appendChild(childrenContainer);
    }

    return container;
  }

  function renderTree() {
    treeContainer.innerHTML = "";
    const term = searchInput.value.toLowerCase();

    function highlightAndExpand(nodeId) {
      const node = nodes[nodeId];
      if (!node) return false;
      let match = node.name.toLowerCase().includes(term) && term !== "";
      // If any child matches, also expand this node
      let childMatch = false;
      for (const c of node.childrenIds) {
        if (highlightAndExpand(c)) {
          childMatch = true;
          node.collapsed = false;
        }
      }
      // Expand parent if child matched
      if (childMatch) node.collapsed = false;

      // If match, expand ancestors
      if (match) {
        let p = node.parentId;
        while (p !== null) {
          nodes[p].collapsed = false;
          p = nodes[p].parentId;
        }
      }
      return match || childMatch;
    }

    // Run highlight & expand on roots
    for (const rootId of roots) {
      highlightAndExpand(rootId);
    }

    for (const rootId of roots) {
      const rootNodeEl = renderNode(rootId);
      treeContainer.appendChild(rootNodeEl);
    }

    // Highlight matched nodes
    if (term !== "") {
      const allNodes = treeContainer.querySelectorAll(".node");
      allNodes.forEach((el) => {
        const id = el.dataset.id;
        if (id && nodes[id].name.toLowerCase().includes(term)) {
          el.classList.add("highlight");
          el.scrollIntoView({ behavior: "smooth", block: "center" });
        } else {
          el.classList.remove("highlight");
        }
      });
    }
  }

  addRootBtn.onclick = () => {
    createNode(null);
    renderTree();
  };

  searchInput.addEventListener("input", () => {
    renderTree();
  });

  // Initialize empty tree
  renderTree();

  // Accessibility: focus tree container for keyboard scroll
  treeContainer.tabIndex = 0;
</script>
</body>
</html>
