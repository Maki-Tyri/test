<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Family Tree</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
</head>
<body class="bg-gradient-to-br from-indigo-500 via-purple-500 to-pink-500 min-h-screen text-gray-900">

<div id="root" class="p-4 max-w-5xl mx-auto"></div>

<footer class="fixed bottom-0 w-full text-center py-2 bg-white bg-opacity-10 text-white backdrop-blur-md text-sm">
  &copy; 2025 Maki Web. All rights reserved
</footer>

<script type="text/javascript">
const { useState, useEffect } = React;

const firebaseConfig = {
  apiKey: "AIzaSyCy9CKJ6CELheBhw7Gs0BgsE1E0FsoYdgU",
  authDomain: "project-955237504610034331.firebaseapp.com",
  databaseURL: "https://project-955237504610034331-default-rtdb.firebaseio.com",
  projectId: "project-955237504610034331",
  storageBucket: "project-955237504610034331.firebasestorage.app",
  messagingSenderId: "76212939677",
  appId: "1:76212939677:web:cc36cc1cadfd106b6e5d74",
  measurementId: "G-RCJ4P82PVM"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.database();

function Login({ onLogin }) {
  const [email, setEmail] = useState("");
  const [password, setPassword] = useState("");
  const [isRegister, setIsRegister] = useState(false);
  const [error, setError] = useState(null);

  const handleSubmit = async (e) => {
    e.preventDefault();
    setError(null);
    try {
      if (isRegister) {
        await auth.createUserWithEmailAndPassword(email, password);
      } else {
        await auth.signInWithEmailAndPassword(email, password);
      }
      onLogin();
    } catch (err) {
      setError(err.message);
    }
  };

  return React.createElement("div", { className: "max-w-md mx-auto mt-24 p-8 bg-white bg-opacity-70 rounded-lg shadow-lg backdrop-blur-md" },
    React.createElement("h2", { className: "text-3xl font-bold mb-6 text-center" }, isRegister ? "Register" : "Login"),
    React.createElement("form", { onSubmit: handleSubmit, className: "space-y-4" },
      React.createElement("input", {
        type: "email",
        placeholder: "Email",
        required: true,
        value: email,
        onChange: e => setEmail(e.target.value),
        className: "w-full px-4 py-2 border rounded-md"
      }),
      React.createElement("input", {
        type: "password",
        placeholder: "Password",
        required: true,
        value: password,
        onChange: e => setPassword(e.target.value),
        className: "w-full px-4 py-2 border rounded-md"
      }),
      React.createElement("button", {
        type: "submit",
        className: "w-full bg-indigo-600 text-white py-2 rounded-md"
      }, isRegister ? "Register" : "Login")
    ),
    error && React.createElement("p", { className: "text-red-600 text-center mt-4" }, error),
    React.createElement("p", {
      className: "mt-6 text-center text-indigo-600 cursor-pointer hover:underline",
      onClick: () => setIsRegister(!isRegister)
    }, isRegister ? "Already have an account? Login" : "No account? Register")
  );
}

function FamilyMember({ member, members, onAddChild, onEdit }) {
  const [collapsed, setCollapsed] = useState(false);
  const spouse = members.find(m => m.spouseId === member.id || m.id === member.spouseId);

  return React.createElement("div", { className: "ml-6 border-l-2 border-indigo-300 pl-4 py-2 relative" },
    React.createElement("div", { className: "flex items-center space-x-2" },
      React.createElement("button", {
        onClick: () => setCollapsed(!collapsed),
        className: "text-indigo-700 font-bold text-lg w-5 h-5 flex items-center justify-center"
      }, collapsed ? "▶" : "▼"),
      React.createElement("span", { className: "font-semibold" }, member.name),
      member.relation && React.createElement("span", { className: "text-sm text-gray-600" }, `(${member.relation})`),
      member.birthDate && React.createElement("span", { className: "text-sm text-gray-500" }, `b. ${member.birthDate}`),
      member.deceased && React.createElement("span", { className: "text-sm text-red-500 ml-2" }, `✝ ${member.deathDate || ''}`),
      React.createElement("button", {
        onClick: () => onAddChild(member.id),
        className: "ml-2 bg-green-500 text-white px-2 rounded"
      }, "+ Child"),
      React.createElement("button", {
        onClick: () => onEdit(member),
        className: "bg-yellow-400 text-white px-2 rounded"
      }, "Edit")
    ),
    spouse && React.createElement("div", { className: "ml-8 mt-1 text-sm text-pink-100 italic" }, `Spouse: ${spouse.name}`),
    !collapsed && member.children && member.children.map(child =>
      React.createElement(FamilyMember, {
        key: child.id,
        member: child,
        members,
        onAddChild,
        onEdit
      })
    )
  );
}

function FamilyTree({ userId }) {
  const [members, setMembers] = useState([]);
  const [form, setForm] = useState({ name: "", relation: "", birthDate: "", deathDate: "", deceased: false, spouseId: "" });
  const [editingId, setEditingId] = useState(null);
  const [parentId, setParentId] = useState(null);

  useEffect(() => {
    const ref = db.ref(`families/${userId}`);
    ref.on("value", snap => {
      const val = snap.val() || {};
      const arr = Object.values(val);
      setMembers(arr);
    });
    return () => ref.off();
  }, [userId]);

  const tree = members.map(m => ({ ...m, children: members.filter(c => c.parentId === m.id) }))
                      .filter(m => !m.parentId);

  const save = () => {
    const id = editingId || Date.now().toString();
    const data = { ...form, id, parentId: parentId || null };
    db.ref(`families/${userId}/${id}`).set(data);
    setForm({ name: "", relation: "", birthDate: "", deathDate: "", deceased: false, spouseId: "" });
    setEditingId(null);
    setParentId(null);
  };

  return React.createElement("div", { className: "bg-white bg-opacity-80 p-6 rounded shadow-md backdrop-blur-md" },
    React.createElement("h2", { className: "text-3xl font-bold mb-6 text-indigo-700" }, "Family Tree"),

    tree.map(member =>
      React.createElement(FamilyMember, {
        key: member.id,
        member,
        members,
        onAddChild: (pid) => { setParentId(pid); setEditingId(null); },
        onEdit: (m) => { setForm(m); setEditingId(m.id); }
      })
    ),

    React.createElement("div", { className: "mt-6 p-4 border rounded bg-indigo-50 max-w-md" },
      React.createElement("h3", { className: "text-xl font-bold mb-2" }, editingId ? "Edit Member" : "Add Member"),
      ["name", "birthDate", "deathDate"].map(field =>
        React.createElement("input", {
          key: field,
          type: field === "birthDate" || field === "deathDate" ? "date" : "text",
          placeholder: field.charAt(0).toUpperCase() + field.slice(1),
          value: form[field] || "",
          onChange: e => setForm({ ...form, [field]: e.target.value }),
          className: "w-full mb-2 px-3 py-1 border rounded"
        })
      ),
      React.createElement("select", {
        value: form.relation || "",
        onChange: e => setForm({ ...form, relation: e.target.value }),
        className: "w-full mb-2 px-3 py-1 border rounded"
      },
        React.createElement("option", { value: "" }, "-- Select Relation --"),
        ["Father", "Mother", "Son", "Daughter", "Spouse", "Brother", "Sister"].map(r =>
          React.createElement("option", { key: r, value: r }, r)
        )
      ),
      React.createElement("select", {
        value: form.spouseId || "",
        onChange: e => setForm({ ...form, spouseId: e.target.value }),
        className: "w-full mb-2 px-3 py-1 border rounded"
      },
        React.createElement("option", { value: "" }, "-- Select Spouse (Optional) --"),
        members.map(m => React.createElement("option", { key: m.id, value: m.id }, m.name))
      ),
      React.createElement("label", { className: "flex items-center space-x-2 mb-2" },
        React.createElement("input", {
          type: "checkbox",
          checked: form.deceased || false,
          onChange: e => setForm({ ...form, deceased: e.target.checked })
        }),
        React.createElement("span", null, "Deceased")
      ),
      React.createElement("div", { className: "flex justify-between" },
        React.createElement("button", {
          onClick: save,
          className: "bg-indigo-600 text-white px-4 py-1 rounded"
        }, editingId ? "Save" : "Add"),
        React.createElement("button", {
          onClick: () => {
            setForm({ name: "", relation: "", birthDate: "", deathDate: "", deceased: false, spouseId: "" });
            setEditingId(null); setParentId(null);
          },
          className: "bg-gray-400 text-white px-4 py-1 rounded"
        }, "Cancel")
      )
    )
  );
}

function App() {
  const [user, setUser] = useState(null);
  useEffect(() => {
    const unsub = auth.onAuthStateChanged(u => setUser(u));
    return () => unsub();
  }, []);
  if (!user) return React.createElement(Login, { onLogin: () => {} });

  return React.createElement("div", null,
    React.createElement("div", { className: "flex justify-between items-center mb-4" },
      React.createElement("h1", { className: "text-4xl font-bold text-white" }, "My Family Tree"),
      React.createElement("button", {
        onClick: () => auth.signOut(),
        className: "bg-white bg-opacity-70 text-indigo-800 px-4 py-2 rounded"
      }, "Logout")
    ),
    React.createElement(FamilyTree, { userId: user.uid })
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(React.createElement(App));
</script>
</body>
</html>
