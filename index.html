<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Family Tree</title>
<style>
  ul { list-style-type: none; }
  .node { cursor: pointer; margin: 5px 0; }
  .children { margin-left: 20px; display: none; }
  .node.editing input {
    font-size: 1em;
  }
</style>
</head>
<body>

<h2>Family Tree</h2>
<div id="tree"></div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

<script>
  // Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyCy9CKJ6CELheBhw7Gs0BgsE1E0FsoYdgU",
    authDomain: "project-955237504610034331.firebaseapp.com",
    databaseURL: "https://project-955237504610034331-default-rtdb.firebaseio.com",
    projectId: "project-955237504610034331",
    storageBucket: "project-955237504610034331.firebasestorage.app",
    messagingSenderId: "76212939677",
    appId: "1:76212939677:web:cc36cc1cadfd106b6e5d74",
    measurementId: "G-RCJ4P82PVM"
  };

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  // Reference to family tree data
  const treeRef = db.ref('familyTree');

  // Load family tree and render
  treeRef.on('value', snapshot => {
    const data = snapshot.val();
    const container = document.getElementById('tree');
    container.innerHTML = ''; // clear
    if (data) {
      container.appendChild(createTreeNode(data));
    } else {
      container.textContent = 'No family data yet.';
    }
  });

  // Create tree node element recursively
  function createTreeNode(node) {
    const li = document.createElement('li');
    li.className = 'node';
    
    // Create span for the name (editable)
    const span = document.createElement('span');
    span.textContent = node.name || 'Unnamed';
    li.appendChild(span);

    // Clicking toggles children visibility
    span.addEventListener('click', () => {
      if (childrenUl.style.display === 'none') {
        childrenUl.style.display = 'block';
      } else {
        childrenUl.style.display = 'none';
      }
    });

    // Inline editing on double click
    span.addEventListener('dblclick', () => {
      li.classList.add('editing');
      const input = document.createElement('input');
      input.type = 'text';
      input.value = span.textContent;
      li.replaceChild(input, span);
      input.focus();

      input.addEventListener('blur', () => finishEditing(input, li, node));
      input.addEventListener('keydown', e => {
        if (e.key === 'Enter') {
          finishEditing(input, li, node);
        }
      });
    });

    // Create children list recursively
    const childrenUl = document.createElement('ul');
    childrenUl.className = 'children';
    childrenUl.style.display = 'none'; // collapsed by default

    if (node.children) {
      for (const key in node.children) {
        const childNode = createTreeNode(node.children[key]);
        childrenUl.appendChild(childNode);
      }
    }

    li.appendChild(childrenUl);

    return li;
  }

  // Finish editing function: save to Firebase
  function finishEditing(input, li, node) {
    const newName = input.value.trim();
    if (newName.length > 0) {
      // Update Firebase data (find node key path)
      // Since this is a simplified example, let's assume we can edit root node only for now
      // You can expand this logic to track full path and keys
      
      // For demo: update root node name only
      treeRef.update({ name: newName });

      // Replace input with span again
      const span = document.createElement('span');
      span.textContent = newName;
      li.replaceChild(span, input);
      li.classList.remove('editing');

      // Re-bind events
      span.addEventListener('click', () => {
        const childrenUl = li.querySelector('.children');
        if (childrenUl.style.display === 'none') {
          childrenUl.style.display = 'block';
        } else {
          childrenUl.style.display = 'none';
        }
      });
      span.addEventListener('dblclick', () => {
        li.classList.add('editing');
        const input = document.createElement('input');
        input.type = 'text';
        input.value = span.textContent;
        li.replaceChild(input, span);
        input.focus();
        input.addEventListener('blur', () => finishEditing(input, li, node));
        input.addEventListener('keydown', e => {
          if (e.key === 'Enter') {
            finishEditing(input, li, node);
          }
        });
      });
    } else {
      // If empty, cancel edit
      const span = document.createElement('span');
      span.textContent = node.name;
      li.replaceChild(span, input);
      li.classList.remove('editing');
    }
  }
</script>

</body>
</html>
