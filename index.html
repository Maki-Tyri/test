<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Collapsible Family Tree with Firebase Realtime DB</title>
<style>
  body {
    font-family: Arial, sans-serif;
    padding: 20px;
  }
  .node {
    margin-left: 20px;
    cursor: pointer;
    user-select: none;
  }
  .children {
    margin-left: 20px;
    display: none;
  }
  .expanded > .children {
    display: block;
  }
  .toggle-icon {
    display: inline-block;
    width: 1em;
  }
</style>
</head>
<body>
  <h2>Family Tree</h2>
  <div id="tree-container">Loading...</div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

  <script>
    // Your Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyCy9CKJ6CELheBhw7Gs0BgsE1E0FsoYdgU",
      authDomain: "project-955237504610034331.firebaseapp.com",
      databaseURL: "https://project-955237504610034331-default-rtdb.firebaseio.com",
      projectId: "project-955237504610034331",
      storageBucket: "project-955237504610034331.firebasestorage.app",
      messagingSenderId: "76212939677",
      appId: "1:76212939677:web:cc36cc1cadfd106b6e5d74",
      measurementId: "G-RCJ4P82PVM"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    // Helper to create tree nodes
    function createNode(name, childrenObj) {
      const nodeDiv = document.createElement('div');
      nodeDiv.classList.add('node');

      const toggleIcon = document.createElement('span');
      toggleIcon.classList.add('toggle-icon');

      const titleSpan = document.createElement('span');
      titleSpan.textContent = name;

      nodeDiv.appendChild(toggleIcon);
      nodeDiv.appendChild(titleSpan);

      const childrenDiv = document.createElement('div');
      childrenDiv.classList.add('children');

      if (childrenObj && Object.keys(childrenObj).length > 0) {
        toggleIcon.textContent = "▶";

        nodeDiv.addEventListener('click', () => {
          const isExpanded = nodeDiv.classList.toggle('expanded');
          toggleIcon.textContent = isExpanded ? "▼" : "▶";
        });

        for (const key in childrenObj) {
          const childNode = childrenObj[key];
          const childTreeNode = createNode(childNode.name, childNode.children);
          childrenDiv.appendChild(childTreeNode);
        }
      } else {
        toggleIcon.textContent = "•";
      }

      nodeDiv.appendChild(childrenDiv);

      return nodeDiv;
    }

    function renderTree(treeData) {
      const container = document.getElementById('tree-container');
      container.innerHTML = '';

      if (!treeData) {
        container.textContent = 'No data found';
        return;
      }

      // Assume root node is id "1"
      const rootNode = treeData["1"];
      if (!rootNode) {
        container.textContent = 'Root node not found';
        return;
      }

      const tree = createNode(rootNode.name, rootNode.children);
      container.appendChild(tree);
    }

    // Listen to realtime DB changes
    const treeRef = database.ref('familyTree');
    treeRef.on('value', (snapshot) => {
      const data = snapshot.val();
      renderTree(data);
    });
  </script>
</body>
</html>
