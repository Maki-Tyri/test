<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Family Tree with Firebase Auth</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f0f4f8; margin:0; padding:0; }
    #login-container, #app-container { max-width: 600px; margin: 40px auto; padding: 20px; background: white; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
    input, button { padding: 10px; margin: 5px 0; width: 100%; box-sizing: border-box; }
    button { background-color: #2c7be5; color: white; border: none; cursor: pointer; border-radius: 4px; }
    button:hover { background-color: #1a5bc8; }
    ul { list-style: none; padding-left: 0; }
    li { background: #e3f2fd; margin: 10px 0; padding: 10px; border-radius: 6px; display: flex; justify-content: space-between; align-items: center; }
    li input[type="text"], li input[type="date"] { width: 40%; padding: 5px; border: 1px solid #ccc; border-radius: 4px; }
    li button { width: 80px; margin-left: 10px; background-color: #e53e3e; }
    li button:hover { background-color: #c53030; }
    #birthday-notifications { background: #d4edda; color: #155724; padding: 10px; margin-bottom: 15px; border-radius: 6px; }
    #logout-btn { background: #e53e3e; margin-top: 10px; }
  </style>
  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
</head>
<body>

<div id="login-container">
  <h2>Login</h2>
  <input type="email" id="email" placeholder="Email" />
  <input type="password" id="password" placeholder="Password" />
  <button id="login-btn">Login</button>
  <p id="login-error" style="color:red;"></p>
</div>

<div id="app-container" style="display:none;">
  <h2>Family Tree</h2>
  <div id="birthday-notifications"></div>
  <input type="text" id="name-input" placeholder="Name" />
  <input type="date" id="birthday-input" />
  <button id="add-btn">Add Member</button>
  <ul id="family-list"></ul>
  <button id="logout-btn">Logout</button>
</div>

<script>
  // Your Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyCy9CKJ6CELheBhw7Gs0BgsE1E0FsoYdgU",
    authDomain: "project-955237504610034331.firebaseapp.com",
    databaseURL: "https://project-955237504610034331-default-rtdb.firebaseio.com",
    projectId: "project-955237504610034331",
    storageBucket: "project-955237504610034331.firebasestorage.app",
    messagingSenderId: "76212939677",
    appId: "1:76212939677:web:cc36cc1cadfd106b6e5d74",
    measurementId: "G-RCJ4P82PVM"
  };

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.database();

  // Elements
  const loginContainer = document.getElementById('login-container');
  const appContainer = document.getElementById('app-container');
  const emailInput = document.getElementById('email');
  const passwordInput = document.getElementById('password');
  const loginBtn = document.getElementById('login-btn');
  const loginError = document.getElementById('login-error');
  const logoutBtn = document.getElementById('logout-btn');

  const nameInput = document.getElementById('name-input');
  const birthdayInput = document.getElementById('birthday-input');
  const addBtn = document.getElementById('add-btn');
  const familyList = document.getElementById('family-list');
  const birthdayNotifications = document.getElementById('birthday-notifications');

  // Login handler
  loginBtn.addEventListener('click', () => {
    loginError.textContent = '';
    const email = emailInput.value.trim();
    const password = passwordInput.value.trim();
    if (!email || !password) {
      loginError.textContent = 'Please enter email and password.';
      return;
    }
    auth.signInWithEmailAndPassword(email, password)
      .catch(err => {
        loginError.textContent = err.message;
      });
  });

  // Logout
  logoutBtn.addEventListener('click', () => {
    auth.signOut();
  });

  // Auth state listener
  auth.onAuthStateChanged(user => {
    if (user) {
      loginContainer.style.display = 'none';
      appContainer.style.display = 'block';
      loadFamilyTree();
      checkBirthdaysToday();
    } else {
      loginContainer.style.display = 'block';
      appContainer.style.display = 'none';
      familyList.innerHTML = '';
      birthdayNotifications.textContent = '';
      emailInput.value = '';
      passwordInput.value = '';
    }
  });

  // Add member handler
  addBtn.addEventListener('click', () => {
    const name = nameInput.value.trim();
    const birthday = birthdayInput.value;
    if (!name || !birthday) {
      alert('Please fill in both name and birthday.');
      return;
    }
    const newMemberRef = db.ref('familyTree').push();
    newMemberRef.set({ name, birthday })
      .then(() => {
        nameInput.value = '';
        birthdayInput.value = '';
      })
      .catch(err => alert('Failed to add member: ' + err.message));
  });

  // Load family tree from DB and listen for changes
  function loadFamilyTree() {
    const familyRef = db.ref('familyTree');
    familyRef.off(); // remove old listeners to avoid duplicates
    familyRef.on('value', snapshot => {
      const data = snapshot.val() || {};
      familyList.innerHTML = '';

      for (const id in data) {
        const member = data[id];
        const li = document.createElement('li');

        // Name input
        const nameInputEl = document.createElement('input');
        nameInputEl.type = 'text';
        nameInputEl.value = member.name;
        nameInputEl.style.flex = '0 0 40%';
        nameInputEl.addEventListener('change', () => {
          db.ref(`familyTree/${id}`).update({ name: nameInputEl.value });
        });

        // Birthday input
        const birthdayInputEl = document.createElement('input');
        birthdayInputEl.type = 'date';
        birthdayInputEl.value = member.birthday;
        birthdayInputEl.style.flex = '0 0 40%';
        birthdayInputEl.addEventListener('change', () => {
          db.ref(`familyTree/${id}`).update({ birthday: birthdayInputEl.value });
          checkBirthdaysToday();
        });

        // Delete button
        const deleteBtn = document.createElement('button');
        deleteBtn.textContent = 'Delete';
        deleteBtn.addEventListener('click', () => {
          if (confirm(`Delete ${member.name}?`)) {
            db.ref(`familyTree/${id}`).remove();
            checkBirthdaysToday();
          }
        });

        li.appendChild(nameInputEl);
        li.appendChild(birthdayInputEl);
        li.appendChild(deleteBtn);
        familyList.appendChild(li);
      }
    });
  }

  // Check birthdays for today and show notifications
  function checkBirthdaysToday() {
    const today = new Date();
    const mmdd = ("0" + (today.getMonth() + 1)).slice(-2) + "-" + ("0" + today.getDate()).slice(-2);

    db.ref('familyTree').once('value').then(snapshot => {
      const data = snapshot.val() || {};
      const birthdayPeople = [];
      for (const id in data) {
        const bday = data[id].birthday;
        if (bday && bday.slice(5) === mmdd) {
          birthdayPeople.push(data[id].name);
        }
      }
      if (birthdayPeople.length) {
        birthdayNotifications.textContent = `ðŸŽ‰ Today's birthdays: ${birthdayPeople.join(", ")}`;
      } else {
        birthdayNotifications.textContent = '';
      }
    });
  }
</script>

</body>
</html>
