<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Responsive Family Tree</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
  <style>
    .line-connector {
      width: 2px;
      background: #6366f1;
      position: absolute;
      left: -12px;
      top: 0;
      bottom: 0;
      z-index: -1;
    }
    @media (max-width: 640px) {
      .family-card {
        flex-direction: column;
        align-items: flex-start;
      }
    }
  </style>
</head>
<body class="bg-gradient-to-br from-indigo-500 via-purple-500 to-pink-500 min-h-screen text-gray-900">

<div id="root" class="p-4 max-w-6xl mx-auto"></div>

<footer class="fixed bottom-0 w-full text-center py-2 bg-white bg-opacity-10 text-white backdrop-blur-md text-sm">
  &copy; 2025 Maki Web. All rights reserved.
</footer>

<script type="text/javascript">
const { useState, useEffect } = React;

const firebaseConfig = {
  apiKey: "AIzaSyCy9CKJ6CELheBhw7Gs0BgsE1E0FsoYdgU",
  authDomain: "project-955237504610034331.firebaseapp.com",
  databaseURL: "https://project-955237504610034331-default-rtdb.firebaseio.com",
  projectId: "project-955237504610034331",
  storageBucket: "project-955237504610034331.appspot.com",
  messagingSenderId: "76212939677",
  appId: "1:76212939677:web:cc36cc1cadfd106b6e5d74"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.database();

function Login({ onLogin }) {
  const [email, setEmail] = useState("");
  const [password, setPassword] = useState("");
  const [isRegister, setIsRegister] = useState(false);
  const [error, setError] = useState(null);

  const handleSubmit = async (e) => {
    e.preventDefault();
    setError(null);
    try {
      if (isRegister) {
        await auth.createUserWithEmailAndPassword(email, password);
      } else {
        await auth.signInWithEmailAndPassword(email, password);
      }
      onLogin();
    } catch (err) {
      setError(err.message);
    }
  };

  return React.createElement("div", { className: "max-w-md mx-auto mt-24 p-8 bg-white bg-opacity-70 rounded-lg shadow-lg backdrop-blur-md" },
    React.createElement("h2", { className: "text-3xl font-bold mb-6 text-center" }, isRegister ? "Register" : "Login"),
    React.createElement("form", { onSubmit: handleSubmit, className: "space-y-4" },
      React.createElement("input", {
        type: "email",
        placeholder: "Email",
        required: true,
        value: email,
        onChange: e => setEmail(e.target.value),
        className: "w-full px-4 py-2 border rounded-md"
      }),
      React.createElement("input", {
        type: "password",
        placeholder: "Password",
        required: true,
        value: password,
        onChange: e => setPassword(e.target.value),
        className: "w-full px-4 py-2 border rounded-md"
      }),
      React.createElement("button", {
        type: "submit",
        className: "w-full bg-indigo-600 text-white py-2 rounded-md"
      }, isRegister ? "Register" : "Login")
    ),
    error && React.createElement("p", { className: "text-red-600 text-center mt-4" }, error),
    React.createElement("p", {
      className: "mt-6 text-center text-indigo-600 cursor-pointer hover:underline",
      onClick: () => setIsRegister(!isRegister)
    }, isRegister ? "Already have an account? Login" : "No account? Register")
  );
}

function FamilyTreeApp() {
  const [user, setUser] = useState(null);
  const [members, setMembers] = useState([]);
  const [loading, setLoading] = useState(true);
  const [search, setSearch] = useState("");
  const [expanded, setExpanded] = useState({});

  useEffect(() => {
    const unsubscribe = auth.onAuthStateChanged(u => {
      if (u) setUser(u);
      else setUser(null);
    });
    return () => unsubscribe();
  }, []);

  useEffect(() => {
    if (!user) return;
    const ref = db.ref(`users/${user.uid}/members`);
    const handler = (snapshot) => {
      const val = snapshot.val() || {};
      setMembers(Object.values(val));
      setLoading(false);
    };
    ref.on("value", handler);
    return () => ref.off("value", handler);
  }, [user]);

  const saveMember = (member) => {
    if (!user) return;
    db.ref(`users/${user.uid}/members/${member.id}`).set(member);
  };

  const deleteMember = (id) => {
    if (!user) return;
    db.ref(`users/${user.uid}/members/${id}`).remove();
  };

  const toggleExpand = (id) => {
    setExpanded(prev => ({ ...prev, [id]: !prev[id] }));
  };

  const renderTree = (member, allMembers, level = 0) => {
    const children = allMembers.filter(m => m.parentId === member.id);
    const isOpen = expanded[member.id] ?? true;

    return (
      React.createElement("div", { key: member.id, className: "relative ml-4 mt-4 pl-4 border-l-2 border-indigo-400" },
        React.createElement("div", { className: "flex items-center family-card gap-2 relative bg-white p-2 rounded shadow-md w-full sm:flex-row flex-col" },
          React.createElement("div", { className: "text-indigo-700 font-semibold" }, member.name),
          React.createElement("span", { className: "text-xs text-gray-600" }, member.relation || ""),
          member.deceased && React.createElement("span", { className: "text-red-500 text-sm" }, "â˜ "),
          React.createElement("button", { className: "ml-auto text-xs text-blue-600", onClick: () => toggleExpand(member.id) }, isOpen ? "Collapse" : "Expand"),
          React.createElement("button", { className: "ml-2 text-xs text-red-500", onClick: () => deleteMember(member.id) }, "Delete")
        ),
        isOpen && children.map(child => renderTree(child, allMembers, level + 1))
      )
    );
  };

  if (!user) return React.createElement(Login, { onLogin: () => setUser(auth.currentUser) });
  if (loading) return React.createElement("div", { className: "text-center text-white mt-10" }, "Loading...");

  const rootMembers = members.filter(m => !m.parentId);
  const filtered = members.filter(m => m.name.toLowerCase().includes(search.toLowerCase()));

  return (
    React.createElement("div", { className: "bg-white bg-opacity-90 rounded-lg p-4 shadow-xl mt-4 mb-20" },
      React.createElement("div", { className: "flex flex-col sm:flex-row sm:items-center justify-between gap-2 mb-4" },
        React.createElement("h1", { className: "text-2xl font-bold text-indigo-700" }, "My Family Tree"),
        React.createElement("input", {
          type: "text",
          placeholder: "Search member...",
          className: "border border-gray-300 px-3 py-1 rounded w-full sm:w-64",
          value: search,
          onChange: e => setSearch(e.target.value)
        })
      ),
      filtered.length === 0 && React.createElement("p", { className: "text-gray-500 italic" }, "No members found."),
      rootMembers.map(root => renderTree(root, members)),
      React.createElement("div", { className: "mt-4 text-center" },
        React.createElement("button", {
          onClick: () => auth.signOut(),
          className: "bg-pink-600 hover:bg-pink-700 text-white px-4 py-2 rounded"
        }, "Logout")
      )
    )
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(React.createElement(FamilyTreeApp));
</script>
</body>
</html>
